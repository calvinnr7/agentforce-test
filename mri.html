<!doctype html>
<html lang="en">
<head>
Â  <meta charset="utf-8" />
Â  <title>Agentforce Test â€“ GitHub Pages MRI </title>
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, interactive-widget=overlays-content">
Â Â 
Â  <meta name="robots" content="noindex,nofollow" />
Â  <meta http-equiv="Content-Security-Policy"
Â  Â  content="default-src 'self' https: data: blob:;
Â  Â  Â  Â  Â  Â  Â script-src 'self' https: 'unsafe-inline' 'unsafe-eval';
Â  Â  Â  Â  Â  Â  Â connect-src 'self' https: wss:;
Â  Â  Â  Â  Â  Â  Â img-src 'self' https: data: blob:;
Â  Â  Â  Â  Â  Â  Â style-src 'self' 'unsafe-inline' https:;
Â  Â  Â  Â  Â  Â  Â frame-src https:;
Â  Â  Â  Â  Â  Â  Â font-src 'self' https: data:;">
<style>
Â  :root{
Â  Â  --brand-green-light: #bfeee1;Â  /* very light mint */
Â  Â  --brand-green:Â  Â  Â  Â #0AA373;Â  /* your brand green */
Â  Â  --brand-green-dark:Â  #0A855F;Â  /* deeper green */
Â  }

Â  body{
Â  Â  margin:0;
Â  Â  min-height:100vh;
Â  Â  display:flex;
Â  Â  align-items:center;
Â  Â  justify-content:center;
Â  Â  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;

Â  Â  /* Top â†’ bottom linear gradient (light to dark) */
Â  Â  background: linear-gradient(
Â  Â  Â  180deg,
Â  Â  Â  var(--brand-green-light) 0%,
Â  Â  Â  var(--brand-green) 45%,
Â  Â  Â  var(--brand-green-dark) 100%
Â  Â  );
Â  }

Â  .card{
Â  Â  background:#fff;
Â  Â  border-radius:16px;
Â  Â  padding:24px;
Â  Â  max-width:760px; width:90%;
Â  Â  box-shadow:0 12px 28px rgba(0,0,0,.25);
Â  Â  color:#111;
Â  }

Â  /* Fix double scroll issue */
Â  .embeddedMessagingLiveRegion {
Â  Â  height: 0 !important;
Â  }
</style>

</head>
<body>
Â  <div class="card">
Â  Â  <h1>Agentforce (MIAW) â€“ Test Page munawir asd</h1>
Â  Â  <p class="muted">Hosted on GitHub Pages. Not indexed. Use for safe agent testing.</p>
Â  Â  <p>
Â  Â  Â  <button onclick="openChat()">Open Chat</button>
Â  Â  Â  <button onclick="location.reload()">Hard Refresh</button>
Â  Â  </p>
Â  Â  <pre id="log" class="muted"></pre>
Â  </div>

Â  <script>
  // --- FIX START ---
  // Flag to ensure we only apply the keyboard listeners once.
  let isKeyboardFixApplied = false;
  // --- FIX END ---

Â  // Helper: read query param
Â  function getParam(name) {
Â  Â  return new URLSearchParams(window.location.search).get(name);
Â  }

Â  // Register the listener BEFORE bootstrap loads, so we never miss the event
Â  window.addEventListener("onEmbeddedMessagingReady", () => {
Â  Â  console.log("âš¡ onEmbeddedMessagingReady fired");

Â  Â  const QUERY_KEYS = {
Â  Â  Â  plan: "pid"
Â  Â  };

Â  Â  const DEFAULT_PLAN_CODE = "p"; // Default plan if PID not passed

Â  Â  // Fetch the pid if sent in the CTA URL or use the Default
Â  Â Â 
Â  Â  const planCode = getParam(QUERY_KEYS.plan) || DEFAULT_PLAN_CODE;
Â  Â Â 
Â  Â  if (planCode) {
Â  Â  Â  embeddedservice_bootstrap.prechatAPI.setHiddenPrechatFields({
Â  Â  Â  Â  // must match the Channel Variable Name you defined in Messaging Setup
Â  Â  Â  Â  "recommendedPlanCode": planCode
Â  Â  Â  });
Â  Â  Â  console.log("ğŸ”’ setHiddenPrechatFields: recommendedPlanCode =", planCode);

Â  Â  Â  // optional: inspect whatâ€™s queued
Â  Â  Â  console.log("ğŸ‘€ getPrechatFields() â†’", embeddedservice_bootstrap.prechatAPI.getPrechatFields?.());
Â  Â  } else {
Â  Â  Â  console.log("â„¹ï¸ No recommendedPlanCode in URL");
Â  Â  }
Â  });

Â  // Init called when bootstrap loads
Â  function initEmbeddedMessaging() {
Â  Â  try {
Â  Â  Â  console.log("â†’ initEmbeddedMessaging()");
Â  Â  Â  embeddedservice_bootstrap.settings.language = "en_US";
Â  Â  Â  embeddedservice_bootstrap.settings.enableUserInputForConversationWithBot = false;
Â  Â  Â  embeddedservice_bootstrap.settings.disableStreamingResponses = true;

Â  Â  Â  embeddedservice_bootstrap.init(
Â  Â  Â  Â  '00DOg000001Vluv',
				'MRI_Messaging_UI',
				'https://onz--dcaidev.sandbox.my.site.com/ESWMRIMessagingUI1758773345576',
				{
					scrt2URL: 'https://onz--dcaidev.sandbox.my.salesforce-scrt.com'
				}
			);
Â  Â  Â  console.log("âœ… init() called");
Â  Â  } catch (err) {
Â  Â  Â  console.error("âŒ init error:", err);
Â  Â  }
Â  }

Â  // Button handler
function openChat() {
Â  if (embeddedservice_bootstrap?.utilAPI?.launchChat) {
Â  Â  embeddedservice_bootstrap.utilAPI.launchChat()
Â  Â  Â  .then(() => {
        console.log("ğŸŸ¢ launchChat() invoked");

        // --- FIX START: Apply Android keyboard fix after chat is launched ---
        if (isKeyboardFixApplied) return; // Don't run again if already applied

        // Select the elements now that they exist in the DOM
        const mainContainer = document.querySelector('#embedded-messaging');
        const inputArea = document.querySelector('embeddedmessaging-input-footer');

        if (!mainContainer || !inputArea) {
            console.error("Keyboard Fix: Could not find chat elements.");
            return;
        }

        // 1. Lock the main container height to prevent it from shrinking
        const initialHeight = window.innerHeight;
        mainContainer.style.height = `${initialHeight}px`;

        // 2. Use VisualViewport API to move the input field above the keyboard
        if (window.visualViewport) {
            window.visualViewport.addEventListener('resize', () => {
                const newHeight = window.visualViewport.height;
                // Calculate keyboard height (with a threshold to avoid minor resizes)
                const keyboardHeight = (initialHeight - newHeight > 100) ? (initialHeight - newHeight) : 0;
                
                // Use transform to move the input area
                inputArea.style.transform = `translateY(-${keyboardHeight}px)`;
            });
        }
        
        isKeyboardFixApplied = true; // Set flag to prevent re-running
        console.log("ğŸ› ï¸ Android keyboard layout fix applied.");
        // --- FIX END ---
      })
Â  Â  Â  .catch(err => console.error("âŒ launchChat() error:", err));
Â  } else {
Â  Â  console.log("â³ utilAPI not ready yet");
Â  }
}
</script>

<script type='text/javascript' src='https://onz--dcaidev.sandbox.my.site.com/ESWMRIMessagingUI1758773345576/assets/js/bootstrap.min.js' onload='initEmbeddedMessaging()'></script>

</body>
</html>

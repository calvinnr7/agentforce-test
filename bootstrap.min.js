var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(f,h,p){if(f==Array.prototype||f==Object.prototype)return f;f[h]=p.value;return f};
$jscomp.getGlobal=function(f){f=["object"==typeof globalThis&&globalThis,f,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var h=0;h<f.length;++h){var p=f[h];if(p&&p.Math==Math)return p}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};
$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(f,h){var p=$jscomp.propertyToPolyfillSymbol[h];if(null==p)return f[h];p=f[p];return void 0!==p?p:f[h]};$jscomp.polyfill=function(f,h,p,q){h&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(f,h,p,q):$jscomp.polyfillUnisolated(f,h,p,q))};
$jscomp.polyfillUnisolated=function(f,h,p,q){p=$jscomp.global;f=f.split(".");for(q=0;q<f.length-1;q++){var w=f[q];if(!(w in p))return;p=p[w]}f=f[f.length-1];q=p[f];h=h(q);h!=q&&null!=h&&$jscomp.defineProperty(p,f,{configurable:!0,writable:!0,value:h})};
$jscomp.polyfillIsolated=function(f,h,p,q){var w=f.split(".");f=1===w.length;q=w[0];q=!f&&q in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var E=0;E<w.length-1;E++){var K=w[E];if(!(K in q))return;q=q[K]}w=w[w.length-1];p=$jscomp.IS_SYMBOL_NATIVE&&"es6"===p?q[w]:null;h=h(p);null!=h&&(f?$jscomp.defineProperty($jscomp.polyfills,w,{configurable:!0,writable:!0,value:h}):h!==p&&(void 0===$jscomp.propertyToPolyfillSymbol[w]&&(p=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[w]=$jscomp.IS_SYMBOL_NATIVE?
$jscomp.global.Symbol(w):$jscomp.POLYFILL_PREFIX+p+"$"+w),$jscomp.defineProperty(q,$jscomp.propertyToPolyfillSymbol[w],{configurable:!0,writable:!0,value:h})))};$jscomp.underscoreProtoCanBeSet=function(){var f={a:!0},h={};try{return h.__proto__=f,h.a}catch(p){}return!1};
$jscomp.setPrototypeOf=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(f,h){f.__proto__=h;if(f.__proto__!==h)throw new TypeError(f+" is not extensible");return f}:null;$jscomp.arrayIteratorImpl=function(f){var h=0;return function(){return h<f.length?{done:!1,value:f[h++]}:{done:!0}}};$jscomp.arrayIterator=function(f){return{next:$jscomp.arrayIteratorImpl(f)}};
$jscomp.makeIterator=function(f){var h="undefined"!=typeof Symbol&&Symbol.iterator&&f[Symbol.iterator];return h?h.call(f):$jscomp.arrayIterator(f)};$jscomp.generator={};$jscomp.generator.ensureIteratorResultIsObject_=function(f){if(!(f instanceof Object))throw new TypeError("Iterator result "+f+" is not an object");};
$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};
$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(f){this.yieldResult=f};$jscomp.generator.Context.prototype.throw_=function(f){this.abruptCompletion_={exception:f,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype.return=function(f){this.abruptCompletion_={return:f};this.nextAddress=this.finallyAddress_};
$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(f){this.abruptCompletion_={jumpTo:f};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(f,h){this.nextAddress=h;return{value:f}};$jscomp.generator.Context.prototype.yieldAll=function(f,h){f=$jscomp.makeIterator(f);var p=f.next();$jscomp.generator.ensureIteratorResultIsObject_(p);if(p.done)this.yieldResult=p.value,this.nextAddress=h;else return this.yieldAllIterator_=f,this.yield(p.value,h)};
$jscomp.generator.Context.prototype.jumpTo=function(f){this.nextAddress=f};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(f,h){this.catchAddress_=f;void 0!=h&&(this.finallyAddress_=h)};$jscomp.generator.Context.prototype.setFinallyBlock=function(f){this.catchAddress_=0;this.finallyAddress_=f||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(f,h){this.nextAddress=f;this.catchAddress_=h||0};
$jscomp.generator.Context.prototype.enterCatchBlock=function(f){this.catchAddress_=f||0;f=this.abruptCompletion_.exception;this.abruptCompletion_=null;return f};$jscomp.generator.Context.prototype.enterFinallyBlock=function(f,h,p){p?this.finallyContexts_[p]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=f||0;this.finallyAddress_=h||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(f,h){h=this.finallyContexts_.splice(h||0)[0];if(h=this.abruptCompletion_=this.abruptCompletion_||h){if(h.isException)return this.jumpToErrorHandler_();void 0!=h.jumpTo&&this.finallyAddress_<h.jumpTo?(this.nextAddress=h.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=f};$jscomp.generator.Context.prototype.forIn=function(f){return new $jscomp.generator.Context.PropertyIterator(f)};
$jscomp.generator.Context.PropertyIterator=function(f){this.object_=f;this.properties_=[];for(var h in f)this.properties_.push(h);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var f=this.properties_.pop();if(f in this.object_)return f}return null};$jscomp.generator.Engine_=function(f){this.context_=new $jscomp.generator.Context;this.program_=f};
$jscomp.generator.Engine_.prototype.next_=function(f){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,f,this.context_.next_);this.context_.next_(f);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(f){this.context_.start_();var h=this.context_.yieldAllIterator_;if(h)return this.yieldAllStep_("return"in h?h["return"]:function(p){return{value:p,done:!0}},f,this.context_.return);this.context_.return(f);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(f){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],f,this.context_.next_);this.context_.throw_(f);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(f,h,p){try{var q=f.call(this.context_.yieldAllIterator_,h);$jscomp.generator.ensureIteratorResultIsObject_(q);if(!q.done)return this.context_.stop_(),q;var w=q.value}catch(E){return this.context_.yieldAllIterator_=null,this.context_.throw_(E),this.nextStep_()}this.context_.yieldAllIterator_=null;p.call(this.context_,w);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var f=this.program_(this.context_);if(f)return this.context_.stop_(),{value:f.value,done:!1}}catch(h){this.context_.yieldResult=void 0,this.context_.throw_(h)}this.context_.stop_();if(this.context_.abruptCompletion_){f=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(f.isException)throw f.exception;return{value:f.return,done:!0}}return{value:void 0,done:!0}};
$jscomp.generator.Generator_=function(f){this.next=function(h){return f.next_(h)};this.throw=function(h){return f.throw_(h)};this.return=function(h){return f.return_(h)};this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(f,h){h=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(h));$jscomp.setPrototypeOf&&f.prototype&&$jscomp.setPrototypeOf(h,f.prototype);return h};
$jscomp.asyncExecutePromiseGenerator=function(f){function h(q){return f.next(q)}function p(q){return f.throw(q)}return new Promise(function(q,w){function E(K){K.done?q(K.value):Promise.resolve(K.value).then(h,p).then(E,w)}E(f.next())})};$jscomp.asyncExecutePromiseGeneratorFunction=function(f){return $jscomp.asyncExecutePromiseGenerator(f())};$jscomp.asyncExecutePromiseGeneratorProgram=function(f){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(f)))};
(()=>{function f(a){try{var b=new URL(a);return!!b&&"https:"===b.protocol}catch(c){return!1}}function h(a=!1){return embeddedservice_bootstrap.isLocalStorageAvailable&&a?localStorage:embeddedservice_bootstrap.isSessionStorageAvailable?sessionStorage:void 0}function p(){let a,b;const c=JSON.stringify({});embeddedservice_bootstrap.isLocalStorageAvailable&&!localStorage.getItem(x)&&(a=c,localStorage.setItem(x,a));embeddedservice_bootstrap.isSessionStorageAvailable&&!sessionStorage.getItem(x)&&(b=c,sessionStorage.setItem(x,
b));(a||b)&&ba("ESW_3RDPARTY_STORAGE_SET_OBJECTS",{orgId:embeddedservice_bootstrap.settings.orgId,localStorageObj:a,sessionStorageObj:b});m("initializeWebStorage","web storage initialized")}function q(a,b=!0){let c;(b=h(b))&&(c=(b.getItem(x)&&JSON.parse(b.getItem(x))||{})[a]);return c}function w(a,b){if(b&&a){const c=b.getItem(x)&&JSON.parse(b.getItem(x))||{};Object.keys(a).forEach(d=>{c[d]=a[d]});0!==Object.keys(c).length&&b.setItem(x,JSON.stringify(c))}}function E(a,b,c=!0,d=!1){const e=h(c);if(e){const g=
e.getItem(x)&&JSON.parse(e.getItem(x))||{};g[a]=b;e.setItem(x,JSON.stringify(g));m("setItemInWebStorage",`${a} set in ${c?"localStorage":"sessionStorage"}`);d&&ba("ESW_3RDPARTY_STORAGE_SET_ITEMS",{orgId:embeddedservice_bootstrap.settings.orgId,key:a,value:b,inLocalStorage:c})}}function K(a){embeddedservice_bootstrap.isLocalStorageAvailable&&!a&&localStorage.removeItem(x);embeddedservice_bootstrap.isSessionStorageAvailable&&sessionStorage.removeItem(x);ba("ESW_3RDPARTY_STORAGE_CLEAR",embeddedservice_bootstrap.settings.orgId);
m("clearWebStorage","web storage cleared")}function Ub(){M=void 0;Ga=new Promise(b=>{Ha=b});P={};ca={};F=void 0;Ia=Ja=da=V=L=!1;ea=fa=void 0;bb();cb();Vb();m("clearInMemoryData","Cleared in-memory data.");const a=db();m("clearInMemoryData",`Reset conversationId. Old conversationId: ${A} & New conversationId: ${a}`);A=a}function eb(a){const b=(c,d)=>{Object.keys(d).forEach(e=>{"object"===typeof c[e]&&typeof("object"===d[e])?b(c[e],d[e]):void 0===c[e]&&(c[e]=d[e])})};a&&"object"===typeof a&&b(embeddedservice_bootstrap.settings,
a)}function ha(a,b,c){if((c||embeddedservice_bootstrap.settings.devMode)&&console&&console[a])console[a]("[EmbeddedServiceBootstrap] "+(Array.isArray(b)?b.join(", "):b))}function m(a,b,c){ha("log",b,c);c={};Object.assign(c,{configDev:embeddedservice_bootstrap.settings.eswConfigDevName,method:a?a:"",stateMessage:b?`[bootstrap][timestamp: ${Date.now()}] ${b}`:"",convId:A,convType:u(),hostUrl:window.location.href});sa(c)}function r(a,b,c){b?ha("warn","Warning: "+b,c):ha("warn","EmbeddedServiceBootstrap sent an anonymous warning.",
c);c={};Object.assign(c,{configDev:embeddedservice_bootstrap.settings.eswConfigDevName,method:a?a:"",stateMessage:b?`[bootstrap][timestamp: ${Date.now()}] ${b}`:"",convId:A,convType:u(),hostUrl:window.location.href});sa(c)}function l(a,b,c,d){b?ha("error",b,d):ha("error","EmbeddedServiceBootstrap responded with an unspecified error.",d);d={};Object.assign(d,Object.assign({},{configDev:embeddedservice_bootstrap.settings.eswConfigDevName,method:a?a:"",errMessage:b?`[bootstrap][timestamp: ${Date.now()}] ${b}`:
""},c&&{errCode:c},{convId:A,convType:u(),hostUrl:window.location.href}));sa(null,d)}function db(){const a=new Uint32Array(32);crypto.getRandomValues(a);let b="";for(let c=0;32>c;c++){if(8===c||12===c||16===c||20===c)b+="-";b=12===c?b+"4":16===c?b+"0123456789abcdef".charAt(a[c]&3|8):b+"0123456789abcdef".charAt(a[c]&15)}return b}function Ka(a,b,c){const d=document.createElementNS("http://www.w3.org/2000/svg",b);Object.getOwnPropertyNames(c).forEach(e=>{"children"===e?c.children.forEach(g=>{Ka(d,g.type,
g)}):d.setAttribute(e,c[e])});a.appendChild(document.createTextNode("\n"));a.appendChild(d);a.appendChild(document.createTextNode("\n"))}function La(a){const b=document.createElementNS("http://www.w3.org/2000/svg","svg");if(a)return b.setAttribute("focusable","false"),b.setAttribute("aria-hidden","true"),b.setAttribute("viewBox","0 0 100 100"),Array.isArray(a)?a.forEach(c=>{Ka(b,c.type,c)}):Ka(b,"path",{d:a}),b;l("renderSVG","Invalid icon data.")}function Wb(){[{name:"document",object:document,functions:"addEventListener createAttribute createComment createDocumentFragment createElementNS createTextNode createRange getElementById getElementsByTagName getElementsByClassName querySelector querySelectorAll removeEventListener".split(" ")},
{name:"window",object:window,functions:"addEventListener clearTimeout dispatchEvent open removeEventListener requestAnimationFrame setInterval setTimeout fetch".split(" ")}].forEach(a=>{a.functions.forEach(b=>{b in a.object&&!Function.prototype.toString.call(a.object[b]).match(/\[native code\]/)&&r("checkForNativeFunctionOverrides","EmbeddedService Messaging Bootstrap may not function correctly with this native JS function modified: "+a.name+"."+b,!0)})})}function ta(a){"string"!==typeof a?l("setAndStoreJwt",
`Expected to receive string, instead received: ${a}.`):(M=a,E(H.JWT,M))}function Xb(){window.addEventListener("message",fb);embeddedservice_bootstrap.isLocalStorageAvailable&&window.addEventListener("storage",gb);try{(new PerformanceObserver(a=>{a.getEntries().forEach(b=>{"reload"===b.type&&t("EMBEDDED_MESSAGING_APP_AFTER_REFRESH")})})).observe({type:"navigation",buffered:!0})}catch(a){l("addEventHandlers",`Unable to initialize PerformanceObserver ${a}.`)}}function fb(a){if(a&&a.data&&a.origin)if(embeddedservice_bootstrap.filePreviewFrame&&
embeddedservice_bootstrap.filePreviewFrame.contentWindow===a.source)switch(a.data.method){case "ESW_APP_SHOW_FILE_PREVIEW_FRAME":hb(!0);break;case "ESW_APP_HIDE_FILE_PREVIEW_FRAME":hb(!1);break;default:r("handleMessageEvent","Unrecognized event name: "+a.data.method)}else if(embeddedservice_bootstrap.siteContextFrame&&embeddedservice_bootstrap.siteContextFrame.contentWindow===a.source)switch(a.data.method){case "ESW_3RDPARTY_STORAGE_READY":ib();break;case "ESW_3RDPARTY_STORAGE_RESPONSE":a.data.data&&
a.data.data.localStorage&&w(a.data.data.localStorage,localStorage);a.data.data&&a.data.data.sessionStorage&&w(a.data.data.sessionStorage,sessionStorage);jb();break;default:r("handleMessageEvent","Unrecognized event name: "+a.data.method)}else if(0===I().indexOf(a.origin)&&embeddedservice_bootstrap.utilAPI.getEmbeddedMessagingFrame().contentWindow===a.source&&embeddedservice_bootstrap.isMessageFromSalesforceDomain(a.origin)||embeddedservice_bootstrap.settings.customDomain&&embeddedservice_bootstrap.isMessageFromCustomDomain(a.origin)){var b=
embeddedservice_bootstrap.utilAPI.getEmbeddedMessagingFrame();switch(a.data.method){case "ESW_APP_READY_EVENT":Ha();break;case "ESW_APP_LOADED":a=C();b=document.getElementById("embeddedMessagingIconContainer");var c=document.getElementById("embeddedMessagingIconChat"),d=document.getElementById("embeddedMessagingLoadingSpinner");embeddedservice_bootstrap.utilAPI.getEmbeddedMessagingFrame()||r("handleAfterAppLoad","Embedded Messaging iframe not available for post-app-load updates.");a?(b&&d&&b.removeChild(d),
c&&(c.style.display="none"),a.disabled=!1,a.classList.remove("embeddedMessagingConversationButtonLoading"),a.classList.add("embeddedMessagingConversationButtonLoaded"),a.classList.add("no-hover")):r("handleAfterAppLoad","Embedded Messaging static button not available for post-app-load updates.");kb();V=!0;try{z("onEmbeddedMessagingInitSuccess")}catch(e){V=!1,l("emitEmbeddedMessagingInitSuccessEvent",`Something went wrong in firing onEmbeddedMessagingInitSuccess event ${e}.`)}break;case "ESW_APP_INITIALIZATION_ERROR":N();
break;case "ESW_APP_MINIMIZE":embeddedservice_bootstrap.minimizeIframe(b,a.data.data);break;case "ESW_APP_MAXIMIZE":embeddedservice_bootstrap.maximizeIframe(b,a.data.data);break;case "ESW_APP_RESET_INITIAL_STATE":W();break;case "ESW_SET_JWT_EVENT":ta(a.data.data);break;case "ESW_CLEAR_WEBSTORAGE_EVENT":K();break;case "ESW_DOWNLOAD_FILE":Yb(a.data.data);break;case "ESW_SET_WEBSTORAGE_FAILEDMESSAGES_EVENT":a=a.data.data;"object"!==typeof a?l("storeFailedMessagesInWebStorage",`Expected to receive object, instead received: ${a}.`):
E(H.FAILED_OUTBOUND_MESSAGE_ENTRIES,a,!1);break;case "ESW_CLEAN_UP_WEBSTORAGE_FAILEDMESSAGES_EVENT":a=H.FAILED_OUTBOUND_MESSAGE_ENTRIES;embeddedservice_bootstrap.isLocalStorageAvailable&&localStorage.getItem(x)&&(b=JSON.parse(localStorage.getItem(x))||{},delete b[a],localStorage.setItem(x,JSON.stringify(b)));embeddedservice_bootstrap.isSessionStorageAvailable&&sessionStorage.getItem(x)&&(b=JSON.parse(sessionStorage.getItem(x))||{},delete b[a],sessionStorage.setItem(x,JSON.stringify(b)));m("removeItemInWebStorage",
`${a} removed from web storage`);break;case "ESW_APP_UPDATE_TITLE_NOTIFICATION":bb(a.data.data);break;case "ESW_APP_SEND_HIDDEN_PRECHAT_FIELDS":t("ESW_APP_RECEIVE_HIDDEN_PRECHAT_FIELDS",P);break;case "ESW_APP_SEND_AUTORESPONSE_PARAMETERS":t("ESW_APP_RECEIVE_AUTORESPONSE_PARAMETERS",ca);break;case "EMBEDDED_MESSAGING_IDENTITY_TOKEN_EXPIRED_EVENT":u()!==y.AUTH?r("handleIdentityTokenExpiredEvent","handleIdentityTokenExpiredEvent method called but User Verification isn\u2019t enabled in Messaging Settings."):
z("onEmbeddedMessagingIdentityTokenExpired");break;case "EMBEDDED_MESSAGING_JWT_RETRIEVAL_FAILURE_EVENT":lb();break;case "ESW_APP_PRECHAT_SUBMIT":Zb(a.data.data);break;case "ESW_APP_SHOW_MINIMIZED_STATE_NOTIFICATION":(a=embeddedservice_bootstrap.utilAPI.getEmbeddedMessagingFrame())&&a.classList.add("hasMinimizedNotification");break;case "EMBEDDED_MESSAGING_REQUEST_TRANSCRIPT_EVENT":$b();break;case "EMBEDDED_MESSAGING_DISPATCH_EVENT_TO_HOST":z(a.data.data&&a.data.data.eventName,{detail:a.data.data.eventDetails||
{}});break;case "EMBEDDED_MESSAGING_PUBLIC_SEND_TEXT_MESSAGE_API_RESPONSE":a=a.data.data;a.success?fa():ea(a.error);ea=fa=void 0;break;case "EMBEDDED_MESSAGING_TEXT_MESSAGE_LINK_CLICK":try{a&&a.data&&a.data.data&&(c=a.data.data,z("onEmbeddedMessageLinkClicked",{detail:Object.assign({},JSON.parse(c.conversationEntry),{link:c.link})}),c.link&&(d=document.createElement("a"),d.setAttribute("href",c.link),d.setAttribute("rel","noopener noreferrer"),!mb()&&embeddedservice_bootstrap.settings.shouldOpenLinksInSameTab||
d.setAttribute("target","_blank"),d.click()))}catch(e){l("handleLinkClick",`Something went wrong in handling a link click: ${e}`)}break;case "EMBEDDED_MESSAGING_SCREENREADER_ANNOUNCEMENT":ac(a.data.data);break;case "ESW_APP_RESET_AND_RELAUNCH":bc();break;default:r("handleMessageEvent","Unrecognized event name: "+a.data.method)}}else l("handleMessageEvent",`Unexpected message origin: ${a.origin}`)}function bc(){O()||embeddedservice_bootstrap.userVerificationAPI.clearSession().then(()=>{embeddedservice_bootstrap.utilAPI.launchChat().then(()=>
{m("handleAppResetAndRelaunch","Reset and Relaunched the client.")}).catch(a=>{l("handleAppResetAndRelaunch",`Failed to Reset and Relaunch the client: ${a}`)})}).catch(a=>{l("handleAppResetAndRelaunch",`Failed to Reset and Relaunch the client: ${a}`)})}function nb(){z("onEmbeddedMessagingButtonClicked");return ob()}function gb(a){a&&a.key&&a.key===x&&null===a.newValue&&O()&&Ma(!1,!0)}function N(){da=!0;try{sa(),z("onEmbeddedMessagingInitError")}catch(a){da=!1,l("emitEmbeddedMessagingInitErrorEvent",
`Something went wrong in firing onEmbeddedMessagingInitError event ${a}.`)}}function ua(a){let b=va()&&!embeddedservice_bootstrap.settings.hideChatButtonOnLoad;b=void 0!==a&&null!==a?a:b;u()===y.AUTH&&(b=b&&wa(F));try{z("onEmbeddedMessagingChannelMenuVisibilityChanged",{detail:{devName:embeddedservice_bootstrap.settings.eswConfigDevName,isVisible:b}})}catch(c){l("emitEmbeddedMessagingChannelMenuVisibilityChangeEvent",`Something went wrong in firing emitEmbeddedMessagingChannelMenuVisibilityChange event ${c}.`)}}
function z(a,b={detail:{}}){if(!a)throw Error(`Expected an eventName parameter with a string value. Instead received ${a}.`);if(b&&!("detail"in b))throw Error(`The options parameter of the event is malformed: ${b}.`);try{"onEmbeddedMessagingConversationOpened"===a&&(Ja=!0),window.dispatchEvent(new CustomEvent(a,b))}catch(c){throw Error("Something went wrong while dispatching the event "+a+":"+c);}}function bb(a){if(a){const b=JSON.parse(a)[0],c=pb;ia&&window.clearInterval(ia);ia=window.setInterval(()=>
{document.title=document.title===b?c:b},1E3)}else window.clearInterval(ia),ia=void 0,document.title=pb}function S(){return document.getElementById("embedded-messaging")}function C(){return document.getElementById("embeddedMessagingConversationButton")}function hb(a){var b=embeddedservice_bootstrap.utilAPI.getEmbeddedMessagingFrame();if(embeddedservice_bootstrap.filePreviewFrame&&b){if(a){if(embeddedservice_bootstrap.filePreviewFrame.classList.add("show"),embeddedservice_bootstrap.filePreviewFrame.contentWindow.focus(),
embeddedservice_bootstrap.filePreviewFrame.setAttribute("aria-hidden","false"),b.tabIndex="-1",b.setAttribute("aria-hidden","true"),b=S())b.inert=!0}else if(embeddedservice_bootstrap.filePreviewFrame.classList.remove("show"),embeddedservice_bootstrap.filePreviewFrame.setAttribute("aria-hidden","true"),b.tabIndex="0",b.setAttribute("aria-hidden","false"),b=S())b.inert=!1;m("setFilePreviewFrameVisibility",`Full size file preview ${a?"shown":"hidden"}`)}}function Yb(a){let b;if(!f(a.attachmentDownloadURL))throw Error(`Invalid attachmentDownloadURL : ${a.attachmentDownloadURL}.`);
b=document.createElement("iframe");b.style.display="none";b.src=a.attachmentDownloadURL||"";document.body.appendChild(b);a.shouldOpenFileInNewTab&&window.open(b.src,"_blank","noreferrer noopener");setTimeout(()=>{document.body.removeChild(b)},1E3)}function qb(a){return new Promise((b,c)=>{let d=I(),e=document.createElement("link");e.id="embeddedMessagingBootstrapStyles";e.class="embeddedMessagingBootstrapStyles";e.href=d+"/assets/styles/bootstrap"+(embeddedservice_bootstrap.settings.devMode?"":".min")+
".css";e.type="text/css";e.rel="stylesheet";e.onerror=c;e.onload=b;document.getElementsByTagName("head")[0].appendChild(e)})}function rb(){return Na(embeddedservice_bootstrap.settings.scrt2URL+"/embeddedservice/v1/embedded-service-config?orgId="+embeddedservice_bootstrap.settings.orgId+"&esConfigName="+embeddedservice_bootstrap.settings.eswConfigDevName+"&language="+embeddedservice_bootstrap.settings.language,"GET","getConfigurationData")}function Oa(){return Na(embeddedservice_bootstrap.settings.scrt2URL+
"/embeddedservice/v1/businesshours?orgId="+embeddedservice_bootstrap.settings.orgId+"&esConfigName="+embeddedservice_bootstrap.settings.eswConfigDevName,"GET","getBusinessHoursInterval").then(a=>{a=a&&a.businessHoursInfo;m("getBusinessHoursInterval","Successfully retrieved Business Hours data");a&&Array.isArray(a.businessHours)&&0<a.businessHours.length&&(Q={startTime:a.businessHours[0].startTime,endTime:a.businessHours[0].endTime},Pa())}).catch(a=>{throw a;})}function sb(a){l("handleBusinessHoursError",
"Failed to retrieve Business Hours data. Retrying the request.",a);return Oa()}function xa(){if(embeddedservice_bootstrap.settings.snippetConfig.expSiteUrl){var a=embeddedservice_bootstrap.settings.snippetConfig.expSiteUrl===window.location.origin;a=`${embeddedservice_bootstrap.settings.snippetConfig.expSiteUrl}${embeddedservice_bootstrap.settings.snippetConfig.expSiteContext===Qa.AURA?"":(a?"/":"")+"vforcesite"}${"/_nc_external/system/security/session/SessionTimeServlet?buster="}${(new Date).getTime()}`;
return Na(a,"GET","getExpSiteSessionTimeout").then(b=>{try{b=JSON.parse(b.substring(b.indexOf("{"),b.indexOf("}")+1))}catch(c){l("getExpSiteSessionTimeout","Error parsing response text from server ",c)}"number"===typeof b.sr&&(m("getExpSiteSessionTimeout","Successfully retrieved experience site session timeout"),0<b.sr?(embeddedservice_bootstrap.settings.snippetConfig.isExpSiteGuestUser=!1,Ra&&clearTimeout(Ra),Ra=setTimeout(()=>{xa()},1E3*b.sr)):(embeddedservice_bootstrap.settings.snippetConfig.isExpSiteGuestUser=
!0,embeddedservice_bootstrap.userVerificationAPI.clearSession()))})}}function Na(a,b,c){const d=performance.now();return new Promise((e,g)=>{const n=new XMLHttpRequest;n.open(b,a,!0);n.onreadystatechange=k=>{if((k=k.target)&&k.readyState===k.DONE||204===k.status){const v=((performance.now()-d)/1E3).toFixed(3);if(200===k.status||204===k.status)if("getExpSiteSessionTimeout"!==c){const G=k.responseText?JSON.parse(k.responseText):k.responseText;e(G)}else e(k.responseText);else g(k.status);m("sendXhrRequest",
`${c?c:a} took ${v} seconds and returned with the status code ${k.status}`)}};n.send()})}function cc(){return O()?tb().then(a=>ya().then(b=>{m("initializeConversationState","finished joining verified user conversation");ja(a,b)}).catch(()=>{N()})):u()===y.UNAUTH?ub()||(embeddedservice_bootstrap.settings.embeddedServiceConfig.termsAndConditions||{}).isTermsAndConditionsEnabled?(ja(),Promise.resolve()):Sa().then(a=>ka(P).then(b=>{m("initializeConversationState","finished creating conversation");ja(a,
b)}).catch(()=>{N()})):Promise.reject(Error("Something went wrong initializing conversation state."))}function vb(a){ja(null,null,a);return Promise.resolve()}function ja(a,b,c,d=!1){var e=q(H.FAILED_OUTBOUND_MESSAGE_ENTRIES,!1);const g=embeddedservice_bootstrap.settings.standardLabels,n=embeddedservice_bootstrap.settings.embeddedServiceConfig.customLabels;if(embeddedservice_bootstrap.settings.imageCompressionOptions){var k=embeddedservice_bootstrap.settings.imageCompressionOptions;k=Object.assign({},
k.quality&&!isNaN(Number(k.quality))&&0<=Number(k.quality)&&1>=Number(k.quality)&&{quality:Number(k.quality)},k.maxHeight&&!isNaN(Number(k.maxHeight))&&0<Number(k.maxHeight)&&{maxHeight:Number(k.maxHeight)},k.maxWidth&&!isNaN(Number(k.maxWidth))&&0<Number(k.maxWidth)&&{maxWidth:Number(k.maxWidth)},k.convertTypes&&("string"===typeof k.convertTypes||Array.isArray(k.convertTypes))&&{convertTypes:k.convertTypes},k.convertSize&&!isNaN(Number(k.convertSize))&&0<=Number(k.convertSize)&&{convertSize:k.convertSize})}k=
Object.assign({},k&&{imageCompressionOptions:k},"boolean"===typeof embeddedservice_bootstrap.settings.enableUserInputForConversationWithBot&&{enableUserInputForConversationWithBot:!!embeddedservice_bootstrap.settings.enableUserInputForConversationWithBot},"boolean"===typeof embeddedservice_bootstrap.settings.shouldShowParticipantChgEvntInConvHist&&{shouldShowParticipantChgEvntInConvHist:!!embeddedservice_bootstrap.settings.shouldShowParticipantChgEvntInConvHist},{shouldMinimizeWindowOnNewTab:embeddedservice_bootstrap.settings.shouldMinimizeWindowOnNewTab},
"boolean"===typeof embeddedservice_bootstrap.settings.disableStreamingResponses&&{disableStreamingResponses:!!embeddedservice_bootstrap.settings.disableStreamingResponses},"boolean"===typeof embeddedservice_bootstrap.settings.sseRetryEnhancement&&{sseRetryEnhancement:!!embeddedservice_bootstrap.settings.sseRetryEnhancement},"boolean"===typeof embeddedservice_bootstrap.settings.showStartNewSessionCTA&&{showStartNewSessionCTA:!!embeddedservice_bootstrap.settings.showStartNewSessionCTA});e=Object.assign({},
embeddedservice_bootstrap.settings.embeddedServiceConfig,Object.assign({},{identityToken:F,failedMessages:e,conversationId:A,devMode:!!embeddedservice_bootstrap.settings.devMode,noSsePatch:!!embeddedservice_bootstrap.settings.noSsePatch,language:embeddedservice_bootstrap.settings.language},g&&{standardLabels:g},n&&{customLabels:n},{hasConversationButtonColorContrastMetA11yThreshold:wb.isValidContrastRatio("#FFFFFF",T("headerColor")),hostUrl:window.location.href},u()===y.EXP_SITE_AUTH&&{expSiteUrl:embeddedservice_bootstrap.settings.snippetConfig.expSiteUrl},
embeddedservice_bootstrap.settings.displayMode&&{displayMode:embeddedservice_bootstrap.settings.displayMode},{snippetSettings:k,capabilitiesVersion:"254"}))||{};a&&(e=Object.assign(e,{jwtData:a}));b&&(e=Object.assign(e,{conversationData:b}));c&&(e=Object.assign(e,{errorData:c}));e.isExistingSessionOnPageLoad=d;t("ESW_SET_CONFIG_EVENT",e)}function Zb(a){const b=Object.assign(a,P);z("onEmbeddedMessagingPreChatSubmitted",{detail:{prechatDisplay:dc.CONVERSATION,prechatSubmitFields:b}});O()?ya().then(c=>
{c&&c.isExistingConversation?(m("handlePrechatSubmit","Pre-chat submitted but a conversation already exits for the verified user. Joining the existing conversation."),t("EMBEDDED_MESSAGING_SET_CONVERSATION_DATA_EVENT",c)):(m("handlePrechatSubmit","Pre-chat submitted. Creating a new conversation."),ka(b).then(d=>{t("EMBEDDED_MESSAGING_SET_CONVERSATION_DATA_EVENT",d)}))}):u()===y.UNAUTH&&(X()?(m("handlePrechatSubmit","Pre-chat submitted but a JWT exists in web storage. Fetching existing conversations."),
M=q(H.JWT),xb().then(c=>{t("ESW_SET_JWT_EVENT",c);ya().then(d=>{d&&d.isExistingConversation?(m("handlePrechatSubmit","Pre-chat submitted but a conversation already exits for the unverified user. Joining the existing conversation."),t("EMBEDDED_MESSAGING_SET_CONVERSATION_DATA_EVENT",d)):(m("handlePrechatSubmit","Pre-chat submitted and no existing conversations found. Creating a new conversation."),ka(b).then(e=>{t("EMBEDDED_MESSAGING_SET_CONVERSATION_DATA_EVENT",e)}))})})):(m("handlePrechatSubmit",
"Pre-chat submitted. Fetching a JWT and starting a new conversation."),Sa().then(c=>{t("ESW_SET_JWT_EVENT",c);ka(b).then(d=>{t("EMBEDDED_MESSAGING_SET_CONVERSATION_DATA_EVENT",d)})})))}function yb(){return new Promise(a=>{embeddedservice_bootstrap.createFilePreviewFrame();embeddedservice_bootstrap.createIframe().then(()=>{a("Created Embedded Messaging frame.")})})}function xb(){return q(H.JWT)?ec().then(a=>{ta(a.accessToken);m("handleGetContinuityJwt","Sucessfully retreived a Continuity JWT");return a}).catch(a=>
{l("handleGetContinuityJwt",`Failed to get Continuity JWT: ${a&&a.message?a.message:a}.`);W()}):Promise.reject(void 0)}function ec(){const a=embeddedservice_bootstrap.settings.scrt2URL.concat("/iamessage/v1/authorization/continuityAccessToken");return Y(a,"GET","cors",null,null,"getContinuityJwt").then(b=>{if(!b.ok)throw b;return b.json()})}function Sa(){return fc().then(a=>{ta(a.accessToken);m("handleGetUnauthenticatedJwt","Successfully retreived an Unauthenticated JWT");return a}).catch(a=>gc(a))}
function zb(a){var b=Ab();b=b?embeddedservice_bootstrap.settings.scrt2URL.concat("/iamessage/v1/authorization/unauthenticated/accessToken","?",b):embeddedservice_bootstrap.settings.scrt2URL.concat("/iamessage/v1/authorization/unauthenticated/accessToken");return Y(b,"POST","cors",{"Content-Type":"application/json"},a,"sendUnauthenticatedJwtRequest").then(c=>{J()&&U();if(!c.ok)throw c;return c.json()})}function fc(){let a={orgId:embeddedservice_bootstrap.settings.orgId,developerName:embeddedservice_bootstrap.settings.eswConfigDevName,
capabilitiesVersion:"254"};return J()?Bb().then(b=>{if(!b)throw Error("ReCaptcha token generation failed at client.");a.captchaToken=b;return zb(a)}):zb(a)}function tb(){return(u()===y.EXP_SITE_AUTH?hc():ic()).then(a=>{a=u()===y.EXP_SITE_AUTH?a.data:a;ta(a.accessToken);m("handleGetAuthenticatedJwt","Successfully retreived an Authenticated JWT");return a}).catch(a=>{J()&&U();a=(null==a?void 0:a.message)||a;l("handleGetAuthenticatedJwt",`Error retrieving authenticated token: ${a}.`);lb();throw a;})}
function hc(){const a=embeddedservice_bootstrap.settings.snippetConfig.expSiteUrl+"/miaw/auth/accesstoken"+`?platformType=${"Web"}&developerName=${embeddedservice_bootstrap.settings.eswConfigDevName}&capabilitiesVersion=${"254"}`,b={Cos:"0x0204","Content-Type":"application/json"};return la(a,"GET","cors",b,null,"getExpSiteAuthenticatedJwt").then(c=>{if(!c.ok)throw c;return c.json()}).catch(c=>za(c,a,"GET","cors",b,null,"getExpSiteAuthenticatedJwt"))}function Cb(a){const b=F,c=Ab(),d=c?embeddedservice_bootstrap.settings.scrt2URL.concat("/iamessage/v1/authorization/authenticated/accessToken",
"?",c):embeddedservice_bootstrap.settings.scrt2URL.concat("/iamessage/v1/authorization/authenticated/accessToken"),e={"Content-Type":"application/json"};return b&&wa(b)?la(d,"POST","cors",e,a,"sendAuthenticatedJwtRequest").then(g=>{J()&&U();if(!g.ok)throw g;return g.json()}).catch(g=>{J()&&U();return za(g,d,"POST","cors",e,a,"sendAuthenticatedJwtRequest")}):(new Promise(g=>{Db({apiPath:d,method:"POST",mode:"cors",requestHeaders:e,requestBody:a,resolve:g})})).then(g=>{J()&&U();if(!g.ok)throw g;return g.json()})}
function ic(){let a={orgId:embeddedservice_bootstrap.settings.orgId,developerName:embeddedservice_bootstrap.settings.eswConfigDevName,capabilitiesVersion:"254",authorizationType:Ta.JWT,customerIdentityToken:F};return J()?Bb().then(b=>{if(!b)throw Error("ReCaptcha token generation failed at client.");a.captchaToken=b;return Cb(a)}):Cb(a)}function jc(){kc().then(()=>{m("handleRegisterDeviceCapabilities","Successfully Registered Device Capabilities.")})}function kc(){const a=embeddedservice_bootstrap.settings.scrt2URL.concat("/iamessage/v1/device/registerDeviceCapabilities");
return Y(a,"POST","cors",null,{},"registerDeviceCapabilities")}function ya(a){return lc(!1,embeddedservice_bootstrap.settings.restrictSessionOnMessagingChannel?embeddedservice_bootstrap.settings.embeddedServiceConfig.embeddedServiceMessagingChannel.channelAddressIdentifier:null).then(b=>{let c=[];if(!b.conversations||!Array.isArray(b.conversations))throw Error(`Invalid conversation list: ${b.conversations}.`);c=b.conversations.filter(d=>0===d.endTimestamp);if(0===c.length){if(a)throw r("handleListConversation",
"No open conversation found, deleting stale data from web storage.",!0),W(),Error("No open conversation found for JWT in web storage.");return ub()||(embeddedservice_bootstrap.settings.embeddedServiceConfig.termsAndConditions||{}).isTermsAndConditionsEnabled?null:(r("handleListConversation","No existing conversation found and pre-chat is not enabled. Will start a new conversation."),ka(P).then(d=>d))}1<c.length&&(r("handleListConversation",`Expected the user to be participating in 1 open conversation but instead found ${c.length}. Loading the conversation with latest startTimestamp.`),
c.sort((d,e)=>e.startTimestamp-d.startTimestamp));b=c[0];if(!mc(b.conversationId))throw Error(`Invalid conversation identifier: ${b.conversationId}.`);m("handleListConversation","Successfully retrieved existing conversation");A!==b.conversationId&&(m("handleListConversation",`ConversationId change detected. Old conversation-id: ${A} & New conversation-id: ${b.conversationId}`),A=b.conversationId);b.isExistingConversation=!0;return b}).catch(b=>{l("handleListConversation",`Failed to list conversation entries: ${b&&
b.message?b.message:b}.`);throw Error(`Failed to list conversation entries: ${b&&b.message?b.message:b}.`);})}function lc(a,b){const c=embeddedservice_bootstrap.settings.scrt2URL.concat("/iamessage/v1/queries/conversation/list");return Y(c,"POST","cors",null,Object.assign({},{includeClosedConversations:a},b&&{channelAddressIdentifier:b}),"listConversation").then(d=>d.json())}function gc(a){if(a&&a.status&&401===a.status)return l("handleGetJwtError","Unauthorized error caused by JWT expiration. Attempt to get another JWT",
a.status),Sa().catch(b=>{throw Error(b);});J()&&U();throw Error(`Error retrieving unauthenticated token: ${(null==a?void 0:a.message)||a}.`);}function ub(){return(embeddedservice_bootstrap.settings.embeddedServiceConfig.forms||[]).some(a=>{a.formFields=a.formFields||[];return"PreChat"===a.formType&&0<a.formFields.length})}function ka(a){if(Ia)return l("handleCreateNewConversation","Attempting to create new conversation multiple times!",null,!0),Promise.resolve();if(a)if("object"===typeof a)for(const [b,
c]of Object.entries(a))m("handleCreateNewConversation",`Pre-chat field: ${b} ${c&&0<c.trim().length?`is set with a value of ${c.length} characters.`:"is not set."}`);else l("handleCreateNewConversation",`Expected to receive a valid object for Pre-Chat fields, instead received ${typeof a}`);Ia=!0;return nc(a).then(b=>{z("onEmbeddedMessagingConversationStarted",{detail:{conversationId:A}});jc();b.esDeveloperName=embeddedservice_bootstrap.settings.eswConfigDevName;m("handleCreateNewConversation",`Initialized the esDeveloperName associated with current conversation to: ${embeddedservice_bootstrap.settings.eswConfigDevName}`);
return b})}function nc(a){const b=embeddedservice_bootstrap.settings.scrt2URL.concat("/iamessage/v1/conversation");return Y(b,"POST","cors",null,Object.assign({},a&&{routingAttributes:a},{conversationId:A,language:embeddedservice_bootstrap.settings.language}),"createNewConversation").then(c=>c.json())}function oc(){const a=embeddedservice_bootstrap.settings.scrt2URL.concat("/iamessage/v1/conversation","/",A,"/transcript");return Y(a,"GET","cors",null,null,"getTranscript").then(b=>b.arrayBuffer())}
function $b(){z("onEmbeddedMessagingTranscriptRequested",{detail:{conversationId:A}});oc().then(a=>{a=new Blob([a],{type:"octet/stream"});a=window.URL.createObjectURL(a);const b=document.createElement("a");b.href=a;b.download="ConversationTranscript.pdf";b.click();window.URL.revokeObjectURL(a);t("EMBEDDED_MESSAGING_REQUEST_TRANSCRIPT_SUCCESS_EVENT");z("onEmbeddedMessagingTranscriptDownloadSuccessful",{detail:{conversationId:A}})}).catch(a=>{if(a){const b=a.status;a=a.message||void 0;t("EMBEDDED_MESSAGING_REQUEST_TRANSCRIPT_ERROR_EVENT",
{detail:{errorCode:b,errorMessage:a}});l("handleRequestTranscript",`Transcript request failed with status code: ${b} & message: ${a}`,b)}else t("EMBEDDED_MESSAGING_REQUEST_TRANSCRIPT_ERROR_EVENT");z("onEmbeddedMessagingTranscriptRequestFailed",{detail:{conversationId:A}})})}function la(a,b,c,d,e,g=a){d=d?d:Object.assign({},{"Content-Type":"application/json"},M&&{Authorization:"Bearer "+M});e=e?JSON.stringify(e):void 0;const n=performance.now();return fetch(a,Object.assign({},{method:b,mode:c,headers:d},
e&&{body:e})).then(k=>$jscomp.asyncExecutePromiseGeneratorFunction(function*(){const v=((performance.now()-n)/1E3).toFixed(3);m("sendFetchRequest",`${g} took ${v} seconds and returned with the status code ${k.status}`);if(!k.ok){let G;try{G=Object.assign(k,yield k.json())}catch(Aa){G=Object.assign(k,{message:`Error reading the body stream of error object: ${k}`})}throw G;}return k}))}function za(a,b,c,d,e,g,n=b){if(!a||!a.status||500<=a.status&&599>=a.status)return l("handleSendFetchRequestError",
`Something went wrong in ${n}: ${a&&a.message?a.message:JSON.stringify(Object.assign({},a,{status:a.status,statusText:a.statusText,type:a.type}))}. Re-trying the request.`,a&&a.status),la(b,c,d,e,g,n).catch(k=>{l("handleSendFetchRequestError",`${n} request failed again: ${k&&k.message?k.message:JSON.stringify(Object.assign({},k,{status:k.status,statusText:k.statusText,type:k.type}))}.`,k&&k.status);throw k;});if(401===a.status){l("handleSendFetchRequestError",`${n}: ${a&&a.message?a.message:JSON.stringify(Object.assign({},
a,{status:a.status,statusText:a.statusText,type:a.type}))}.`,a&&a.status);if(u()===y.UNAUTH)throw K(),a;if(O())return F&&wa(F)||u()===y.EXP_SITE_AUTH?new Promise(k=>{Eb({apiPath:b,method:c,mode:d,requestHeaders:e,requestBody:g,resolve:k})}):new Promise(k=>{Db({apiPath:b,method:c,mode:d,requestHeaders:e,requestBody:g,resolve:k})})}else if(423===a.status){const k={};Object.assign(k,{errorStatus:a.status,errorCode:a.errorCode});if(a.errorCode&&"ORG_UNDER_MAINTENANCE"===a.errorCode||"ORG_NOT_SUPPORTED"===
a.errorCode)l("handleSendFetchRequestError",`Received a ${a.status} in ${n}: ${a&&a.message?a.message:JSON.stringify(Object.assign({},a,{status:a.status,statusText:a.statusText,type:a.type}))}`,a&&a.status),V?t("EMBEDDED_MESSAGING_CONVO_ERROR_DATA_RECEIVED",k):vb(k)}else throw l("handleSendFetchRequestError",`Something went wrong in ${n}: ${a&&a.message?a.message:JSON.stringify(Object.assign({},a,{status:a.status,statusText:a.statusText,type:a.type}))}`,a&&a.status),a;}function Y(a,b,c,d,e,g){return la(a,
b,c,d,e,g).catch(n=>za(n,a,b,c,d,e,g))}function Ab(){let a="";const b=Ua();b&&(a=(new URLSearchParams({os:b.os.name,osVersion:b.os.version,browser:b.browser.name,browserVersion:b.browser.version})).toString());return a}function Ua(){var a=[navigator.platform,navigator.userAgent,navigator.appVersion,navigator.vendor,window.opera].join(" ");const b=Fb(a,[{name:"Windows Phone",value:"Windows Phone",version:"OS"},{name:"Windows",value:"Win",version:"NT"},{name:"iPhone",value:"iPhone",version:"OS"},{name:"iPad",
value:"iPad",version:"OS"},{name:"Kindle",value:"Silk",version:"Silk"},{name:"Android",value:"Android",version:"Android"},{name:"PlayBook",value:"PlayBook",version:"OS"},{name:"BlackBerry",value:"BlackBerry",version:"/"},{name:"Macintosh",value:"Mac",version:"OS X"},{name:"Linux",value:"Linux",version:"rv"},{name:"Palm",value:"Palm",version:"PalmOS"}]);a=Fb(a,[{name:"Edge",value:"Edg",version:"Edg"},{name:"Chrome",value:"Chrome",version:"Chrome"},{name:"Firefox",value:"Firefox",version:"Firefox"},
{name:"Safari",value:"Safari",version:"Version"},{name:"Internet Explorer",value:"MSIE",version:"MSIE"},{name:"Opera",value:"Opera",version:"Opera"},{name:"BlackBerry",value:"CLDC",version:"CLDC"},{name:"Mozilla",value:"Mozilla",version:"Mozilla"}]);return{os:b,browser:a}}function Fb(a,b){let c;let d;for(c=0;c<b.length;c+=1){var e=new RegExp(b[c].value,"i");if(e=e.test(a)){e=new RegExp(b[c].version+"[- /:;]([\\d._]+)","i");e=a.match(e);d="";e&&e[1]&&(e=e[1]);if(e)for(e=e.split(/[._]+/),a=0;a<e.length;a+=
1)d=0===a?d+(e[a]+"."):d+e[a];else d="0";return{name:b[c].name,version:parseFloat(d)}}}return{name:"unknown",version:0}}function I(){try{return embeddedservice_bootstrap.settings.siteURL}catch(a){l("getSiteURL",`Error getting Site URL: ${a}`)}}function D(a,b){for(const c of embeddedservice_bootstrap.settings.embeddedServiceConfig.customLabels)if(c.sectionName===a&&c.labelName===b)return c.labelValue||"";for(const c of embeddedservice_bootstrap.settings.standardLabels)if(c.sectionName===a&&c.labelName===
b)return c.labelValue||"";return""}function T(a){for(const b of embeddedservice_bootstrap.brandingData)if(b.n&&b.n===a)return b.v}function pc(){const a=embeddedservice_bootstrap.settings.chatButtonPosition;if("string"===typeof a&&0<a.length){const b=a.split(",");2!==b.length?l("setButtonPositionStyles",`Invalid embeddedservice_bootstrap.settings.chatButtonPosition value specified: ${a}. Valid format is "25px, 30px".`):(document.documentElement.style.setProperty("--eswButtonBottom",b[0].trim()),document.documentElement.style.setProperty("--eswButtonRight",
b[1].trim()))}}function Gb(){let a=C(),b=document.getElementById("embeddedMessagingIconContainer"),c=document.getElementById("embeddedMessagingIconChat"),d=document.createElement("div"),e=document.createElement("span"),g,n=1;if(a){c.style.display="none";d.setAttribute("class","embeddedMessagingLoadingSpinner");d.setAttribute("id","embeddedMessagingLoadingSpinner");for(embeddedservice_bootstrap.settings.embeddedServiceConfig.htmlDirection&&"string"===typeof embeddedservice_bootstrap.settings.embeddedServiceConfig.htmlDirection&&
d.setAttribute("dir",embeddedservice_bootstrap.settings.embeddedServiceConfig.htmlDirection.toLowerCase());13>n;n++)g=document.createElement("div"),g.setAttribute("class","embeddedMessagingLoadingCircle"+n+" embeddedMessagingLoadingCircle"),d.appendChild(g);d.classList.add("embeddedMessagingIconLoading");a.classList.add("embeddedMessagingConversationButtonLoading");b.insertBefore(d,c);a.disabled=!0;e.className="slds-assistive-text";e.setAttribute("role","alert");e.innerHTML=D("EmbeddedMessagingPrechat",
"PrechatSubmitButtonLoading")||"Loading";d.appendChild(e)}}function Va(){return-1===navigator.userAgent.indexOf("Mobi")}function va(){if(!Q)return!0;const a=Number(Q.startTime),b=Number(Q.endTime),c=Date.now();return c>=a&&c<b?!0:!1}function Pa(){let a;if(Q){var b=va();b?a=Number(Q.endTime):(a=Number(Q.startTime),z("onEmbeddedMessagingBusinessHoursEnded"));isNaN(a)||(ma&&clearTimeout(ma),ma=setTimeout(()=>{clearTimeout(ma);ma=void 0;qc(b);b?z("onEmbeddedMessagingBusinessHoursEnded"):z("onEmbeddedMessagingBusinessHoursStarted")},
a-Date.now()))}}function qc(a){a?(Q=void 0,embeddedservice_bootstrap.utilAPI.hideChatButton(),Oa().then(Pa()).catch(b=>sb(b))):(na()||embeddedservice_bootstrap.utilAPI.showChatButton(),Pa())}function rc(){const a=!!navigator.userAgent.match(/iP(hone|ad|od)/i);var b=navigator.userAgent.match(/(?!=OS)(([0-9]){2})/i);b=b&&0<b.length?Number(b[0]):-1;const c=!!navigator.userAgent.match(/WebKit/i)&&!navigator.userAgent.match(/CriOS/i);return a&&c&&15<=b}function na(){try{return embedded_svc&&embedded_svc.menu?
!0:!1}catch(a){return!1}}function mb(){return navigator.userAgent.includes("CommunityHybridContainer")||navigator.userAgent.includes("playgroundcommunity")}function Ba(){return embeddedservice_bootstrap.settings.snippetConfig.expSiteContext===Qa.LWR||embeddedservice_bootstrap.settings.snippetConfig.expSiteContext===Qa.AURA}function Ca(){return embeddedservice_bootstrap.settings.displayMode===Hb.INLINE}function Wa(a){const b=embeddedservice_bootstrap.settings.targetElement.children;let c;for(const d in b)c=
b[d],c!==S()&&c!==embeddedservice_bootstrap.filePreviewFrame&&(c.inert=a)}function ac(a){const b=document.getElementById("embeddedMessagingLiveRegion");b.textContent=a.text;Xa&&clearTimeout(Xa);Xa=setTimeout(()=>{b.textContent=""},3E3)}function Ib(){const a=document.querySelector('meta[name="viewport"]');a&&(a.setAttribute("content",Z),Z=void 0)}function t(a,b){Ga.then(()=>{const c=embeddedservice_bootstrap.utilAPI.getEmbeddedMessagingFrame();if("string"!==typeof a)throw Error(`Expected a string to use as message param in post message, instead received ${a}.`);
c&&c.contentWindow?c.contentWindow.postMessage(Object.assign({},{method:a},b&&{data:b}),I()):r("sendPostMessageToAppIframe",`Embedded Messaging iframe not available for post message with method ${a}.`)})}function ba(a,b){sc.then(()=>{const c=embeddedservice_bootstrap.siteContextFrame;if("string"!==typeof a)throw Error(`Expected a string to use as message param in post message, instead received ${a}.`);c&&c.contentWindow?c.contentWindow.postMessage(Object.assign({},{method:a},b&&{data:b}),I()):r("sendPostMessageToSiteContextIframe",
`Embedded Messaging site context iframe not available for post message with method ${a}.`)})}function Jb(){ba("ESW_PREFETCH_LWR_RESOURCES")}function tc(a){a||l("handleAuraSite","Failed to load aura app. Iframe is undefined.");a.src=I()+"/embeddedService/embeddedService.app"}function uc(a){let b=I();a||l("handleLWRSite","Failed to load LWR site. Iframe is undefined.");b.endsWith("/")||(b+="/");a.src=b+"?lwc.mode="+(embeddedservice_bootstrap.settings.devMode?"dev":"prod")}function ob(){return new Promise((a,
b)=>{try{let c=C(),d=embeddedservice_bootstrap.utilAPI.getEmbeddedMessagingFrame();if(c&&!c.classList.contains("embeddedMessagingConversationButtonLoaded")){if(X())return m("handleClick","Conversation button clicked but a JWT exists in web storage. Joining the existing conversation."),M=q(H.JWT),Kb(!1).then(()=>{a()}).catch(e=>{N();l("handleClick",e.message);b(e)});E(H.CONVERSATION_BUTTON_CLICK_TIME,Date.now(),!0,!0);Gb();m("handleClick","Conversation button clicked");yb().then(()=>{a()}).catch(e=>
{l("handleClick",e.message);b(e)});(embeddedservice_bootstrap.settings.embeddedServiceConfig.fallbackMessage||{}).isFallbackMessageEnabled?vb():cc().catch(e=>{N();l("handleClick",e.message);b(e)})}else c&&c.classList.contains("embeddedMessagingConversationButtonLoaded")&&d&&d.classList&&d.classList.contains("isMaximized")?t("ESW_APP_MINIMIZE"):l("handleClick","Something went wrong handling button click event.")}catch(c){b(c)}})}function vc(a){let b=embeddedservice_bootstrap.utilAPI.getEmbeddedMessagingFrame();
a&&a.key&&(a.key===oa.SPACE||a.key===oa.ENTER?(a.preventDefault(),nb()):a.key===oa.TAB&&a.shiftKey&&b&&b.classList&&b.classList.contains("isMaximized")&&(a.preventDefault(),t("trapfocustolast")))}function wc(){const a=document.getElementById("embeddedMessagingMinimizedNotification"),b=C();a&&a.parentNode.removeChild(a);b&&b.focus()}function xc(a){if(a.key===oa.ENTER||a.key===oa.SPACE)a.preventDefault(),this.handleNotificationDimissButtonClick()}function X(){return!!q(H.JWT)}function Kb(a){if(q(H.JWT))return Gb(),
yb().catch(l),xb().then(b=>{ya(a).then(c=>{ja(b,c,null,a)})}).catch(l)}function W(a){m("resetClientToInitialState","Resetting client to initial state.");try{K(a),Ub(),p()}catch(b){l("resetClientToInitialState",`Error on clearing web storage for the previously ended conversation: ${b}`)}Z&&Ib();Ya.test(navigator.userAgent)&&Wa(!1);embeddedservice_bootstrap.removeMarkup();Lb()?Mb().then(()=>Nb()):Nb()}function Nb(){if(u()===y.UNAUTH||u()===y.EXP_SITE_AUTH&&!embeddedservice_bootstrap.settings.snippetConfig.isExpSiteGuestUser)u()===
y.EXP_SITE_AUTH&&xa(),embeddedservice_bootstrap.generateMarkup(),C()&&C().focus();m("resetClientToInitialState","Successfully reset client to initial state.");pa&&"function"===typeof pa&&(pa(),m("resolveClearSessionPromise","Resolved Clear Session promise."),pa=void 0)}function yc(){const a=document.createElement("div");a.id="embeddedMessagingModalOverlay";return a}function sa(a,b){a&&Da.currentStateLogs.push(a);b&&Da.errorLogs.push(b);Ga.then(()=>{t("EMBEDDED_MESSAGING_PUSH_PARENT_FRAME_LOGS",{pendingLogs:Da});
cb()})}function cb(){Da={currentStateLogs:[],errorLogs:[]}}function Za(){}function Ma(a,b,c=!1){embeddedservice_bootstrap.utilAPI.getEmbeddedMessagingFrame()?t("EMBEDDED_MESSAGING_CLEAR_USER_SESSION_EVENT",{shouldRevokeJwt:a,shouldEndSession:c}):W(b)}function Eb(a){return new Promise(b=>{m("renewAuthenticatedJwt","Renewing Authenticated JWT");tb().then(()=>{Ob(a);b()})})}function Ob(a){a&&la(a.apiPath,a.method,a.mode,a.requestHeaders,a.requestBody).then(b=>{a.resolve&&"function"===typeof a.resolve&&
a.resolve(b)}).catch(b=>za(b,a.apiPath,a.method,a.mode,a.requestHeaders,a.requestBody))}function Db(a){if(a){z("onEmbeddedMessagingIdentityTokenExpired");var b=new Promise(d=>{qa=d}),c=new Promise((d,e)=>{setTimeout(()=>{e()},3E4)});Promise.race([b,c]).then(()=>{m("handleIdentityTokenExpiry","Valid identity token found. Fetch authenticated JWT.");a.apiPath.includes("/accessToken")?(a.requestBody.customerIdentityToken=F,Ob(a)):Eb(a)}).catch(()=>{l("handleIdentityTokenExpiry","Failed to fetch authenticated JWT due to setIdentityToken timeout or other error. Clearing the messaging session on all tabs.");
Ma(!1,!1)})}}function lb(){let a;W(!1);embeddedservice_bootstrap.generateMarkup();a=C();var b=document.getElementById("embeddedMessagingIconChat");var c=document.getElementById("embeddedMessagingIconContainer");if(a){a.style.display="block";a.setAttribute("tabindex",-1);a.style.setProperty("cursor","default");a.classList.add("no-hover");c&&b&&c.removeChild(b);J()&&U();b=La(Ea.REFRESH);b.setAttribute("id","embeddedMessagingIconRefresh");b.setAttribute("class","embeddedMessagingIconRefresh");c.appendChild(b);
c=document.createElement("div");b=document.createElement("div");const e=document.createElement("span"),g=document.createElement("span");var d=document.createElement("button");const n=document.createElement("span"),k=document.createElement("span");d.className="embeddedMessagingMinimizedNotificationDismissButton";d.addEventListener("click",wc);d.addEventListener("keydown",xc);d.setAttribute("aria-describedby","dismissButton-help");n.className="embeddedMessagingMinimizedNotificationDismissButtonText";
n.title=D("EmbeddedMessagingMinimizedState","NotificationDismissButtonText")||"Dismiss";n.innerHTML=D("EmbeddedMessagingMinimizedState","NotificationDismissButtonText")||"Dismiss";n.style.setProperty("font-family",T("font"));k.className="slds-assistive-text";k.id="dismissButton-help";k.innerHTML=D("EmbeddedMessagingMinimizedState","MinimizedNotificationDismissButtonAssistiveText")||"Close the chat notification";d.appendChild(n);d.appendChild(k);c.id="embeddedMessagingMinimizedNotification";c.className=
"embeddedMessagingMinimizedNotification";embeddedservice_bootstrap.settings.embeddedServiceConfig.htmlDirection&&"string"===typeof embeddedservice_bootstrap.settings.embeddedServiceConfig.htmlDirection&&c.setAttribute("dir",embeddedservice_bootstrap.settings.embeddedServiceConfig.htmlDirection.toLowerCase());b.className="embeddedMessagingMinimizedNotificationTextWrapper";e.className="embeddedMessagingMinimizedNotificationText";embeddedservice_bootstrap.settings.embeddedServiceConfig.htmlDirection&&
"string"===typeof embeddedservice_bootstrap.settings.embeddedServiceConfig.htmlDirection&&e.setAttribute("dir",embeddedservice_bootstrap.settings.embeddedServiceConfig.htmlDirection.toLowerCase());e.role="status";e.title=D("EmbeddedMessagingMinimizedState","JWTRetrievalFailureText")||"Something went wrong. Log in again to continue your messaging conversation.";e.innerHTML=D("EmbeddedMessagingMinimizedState","JWTRetrievalFailureText")||"Something went wrong. Log in again to continue your messaging conversation.";
e.style.setProperty("font-family",T("font"));g.className="slds-assistive-text";g.innerHTML=D("EmbeddedMessagingMinimizedState","MinimizedNotificationAssistiveText")||"Expand the text.";b.appendChild(e);b.appendChild(g);c.appendChild(b);c.appendChild(d);a.disabled=!0;embeddedservice_bootstrap.settings.targetElement.appendChild(c)}}function Pb(a){a=a.split(".")[1].replace(/-/g,"+").replace(/_/g,"/");a=decodeURIComponent(window.atob(a).split("").map(function(b){return"%"+("00"+b.charCodeAt(0).toString(16)).slice(-2)}).join(""));
return JSON.parse(a)}function wa(a){let b,c;if(!a)return embeddedservice_bootstrap.settings.devMode&&m("validateJwt","Empty jwt parameter passed in - skipping validation."),!1;try{return b=Pb(a),c=Math.floor(Date.now()/1E3)<b.exp,embeddedservice_bootstrap.settings.devMode&&!c&&m("validateJwt",`JWT has expired at ${(new Date(1E3*b.exp)).toString()}`),c}catch(d){return embeddedservice_bootstrap.settings.devMode&&l("validateJwt",`JWT validation failed: ${d.message}`),!1}}function u(){let a=null;try{a=
embeddedservice_bootstrap.settings.embeddedServiceConfig&&embeddedservice_bootstrap.settings.embeddedServiceConfig.embeddedServiceMessagingChannel&&embeddedservice_bootstrap.settings.embeddedServiceConfig.embeddedServiceMessagingChannel.authMode}catch(b){l("getAuthMode",`Failed to retrieve auth mode flag: ${b.message}`)}return a}function O(){return u()===y.AUTH||u()===y.EXP_SITE_AUTH}function ra(){}function Qb(a,b,c,d){const e="setHiddenPrechatFields"===a;var g=e?zc():aa();const n=g.map(({name:k})=>
k);g=g.find(k=>k.name===b);return n.includes(b)?"string"===typeof c&&(c.toLowerCase().includes("javascript:")||c.toLowerCase().includes("<script>"))?(l("validatePrechatField",`JavaScript isn't allowed in the value for the ${b} field when calling ${a}.`),!1):c&&String(c).length>g.maxLength?(l("validatePrechatField",`Value for the ${b} field in ${a} exceeds the maximum length restriction of ${g.maxLength} characters.`),!1):e&&"string"!==typeof c?(l("validatePrechatField",`You must specify a string for the ${b} field in ${a} instead of a ${typeof c} value.`),
!1):d&&"boolean"!==typeof d?(l("validatePrechatField","setVisiblePrechatFields was called with isEditableByEndUser set to a value that\u2019s not boolean. Enter a boolean value."),!1):!0:(l("validatePrechatField",`${a} called with an invalid field name ${b}.`),!1)}function zc(){let a=[];var b=Array.isArray(embeddedservice_bootstrap.settings.embeddedServiceConfig.forms)&&embeddedservice_bootstrap.settings.embeddedServiceConfig.forms.length&&Array.isArray(embeddedservice_bootstrap.settings.embeddedServiceConfig.forms[0].hiddenFormFields)?
!0:!1;b&&(a=embeddedservice_bootstrap.settings.embeddedServiceConfig.forms[0].hiddenFormFields);return a}function aa(){return Array.isArray(embeddedservice_bootstrap.settings.embeddedServiceConfig.forms)&&embeddedservice_bootstrap.settings.embeddedServiceConfig.forms.length&&Array.isArray(embeddedservice_bootstrap.settings.embeddedServiceConfig.forms[0].formFields)&&embeddedservice_bootstrap.settings.embeddedServiceConfig.forms[0].formFields.length?embeddedservice_bootstrap.settings.embeddedServiceConfig.forms[0].formFields:
[]}function Fa(a){return L?!0:(l("shouldProcessPrechatFieldsFromHost",`Can't call ${a} before the onEmbeddedMessagingReady event is fired.`),!1)}function mc(a){return"string"===typeof a&&0<a.trim().length?!0:!1}function Vb(){aa().forEach(a=>{delete a.value;delete a.isEditableByEndUser})}function $a(){}function Rb(a){return L?!0:(l("shouldProcessAutoResponseParametersFromHost",`[${a}] Cannot invoke Auto-Response API before the onEmbeddedMessagingReady event is fired.`),!1)}function R(){}function B(){this.settings=
{devMode:!1,targetElement:document.body};this.isSessionStorageAvailable=this.isLocalStorageAvailable=!0;Object.defineProperties(Ea,{CHAT:{value:"M50 0c27.614 0 50 20.52 50 45.833S77.614 91.667 50 91.667c-8.458 0-16.425-1.925-23.409-5.323-13.33 6.973-21.083 9.839-23.258 8.595-2.064-1.18.114-8.436 6.534-21.767C3.667 65.54 0 56.08 0 45.833 0 20.52 22.386 0 50 0zm4.583 61.667H22.917a2.917 2.917 0 000 5.833h31.666a2.917 2.917 0 000-5.833zm12.5-15.834H22.917a2.917 2.917 0 000 5.834h44.166a2.917 2.917 0 000-5.834zM79.583 30H22.917a2.917 2.917 0 000 5.833h56.666a2.917 2.917 0 000-5.833z"},
MINIMIZE_MODAL:{value:"M47.6,17.8L27.1,38.5c-0.6,0.6-1.6,0.6-2.2,0L4.4,17.8c-0.6-0.6-0.6-1.6,0-2.2l2.2-2.2 c0.6-0.6,1.6-0.6,2.2,0l16.1,16.3c0.6,0.6,1.6,0.6,2.2,0l16.1-16.2c0.6-0.6,1.6-0.6,2.2,0l2.2,2.2C48.1,16.3,48.1,17.2,47.6,17.8z"},REFRESH:{value:"M46.5,4h-3C42.7,4,42,4.7,42,5.5v7c0,0.9-0.5,1.3-1.2,0.7l0,0c-0.3-0.4-0.6-0.7-1-1c-5-5-12-7.1-19.2-5.7 c-2.5,0.5-4.9,1.5-7,2.9c-6.1,4-9.6,10.5-9.7,17.5c-0.1,5.4,2,10.8,5.8,14.7c4,4.2,9.4,6.5,15.2,6.5c5.1,0,9.9-1.8,13.7-5 c0.7-0.6,0.7-1.6,0.1-2.2l-2.1-2.1c-0.5-0.5-1.4-0.6-2-0.1c-3.6,3-8.5,4.2-13.4,3c-1.3-0.3-2.6-0.9-3.8-1.6 C11.7,36.6,9,30,10.6,23.4c0.3-1.3,0.9-2.6,1.6-3.8C15,14.7,19.9,12,25.1,12c4,0,7.8,1.6,10.6,4.4c0.5,0.4,0.9,0.9,1.2,1.4 c0.3,0.8-0.4,1.2-1.3,1.2h-7c-0.8,0-1.5,0.7-1.5,1.5v3.1c0,0.8,0.6,1.4,1.4,1.4h18.3c0.7,0,1.3-0.6,1.3-1.3V5.5 C48,4.7,47.3,4,46.5,4z"}});
this.brandingData=[]}function Ac(){const a=document.createElement("iframe"),b=new URL(`${I()}/assets/htdocs/sitecontext${embeddedservice_bootstrap.settings.devMode?"":".min"}.html`);b.searchParams.set("parent_domain",window.location.origin);embeddedservice_bootstrap.settings.devMode&&b.searchParams.set("dev_mode",!0);a.classList.add("embeddedMessagingSiteContextFrame");a.id="embeddedMessagingSiteContextFrame";a.name="embeddedMessagingSiteContextFrame";a.src=b.href;a.onload=()=>{m("createSiteContextFrame",
"Created an iframe for siteContext.")};embeddedservice_bootstrap.siteContextFrame=a;document.body.appendChild(a)}function U(){let a=document.querySelector(".embeddedMessagingGRecaptchaBanner .grecaptcha-badge");a&&(a.style.visibility="hidden")}function J(){const a=embeddedservice_bootstrap.settings.embeddedServiceConfig.messagingChannel;return null!=a&&null!=a.captchaInfo&&a.captchaInfo.siteKey}function Lb(){const a=u()!==y.EXP_SITE_AUTH,b="undefined"===typeof ab||"undefined"===typeof grecaptcha;
return J()&&!X()&&a&&b}function Mb(){return new Promise((a,b)=>{const c=embeddedservice_bootstrap.settings.embeddedServiceConfig.messagingChannel.captchaInfo.siteKey,d=document.createElement("script");d.src="https://www.google.com/recaptcha/api.js?render=explicit";const e=document.createElement("div");e.id="embeddedMessagingRecaptchaBanner";e.classList.add("embeddedMessagingGRecaptchaBanner");let g="bottomright";g=embeddedservice_bootstrap.settings.embeddedServiceConfig.htmlDirection&&"string"===
typeof embeddedservice_bootstrap.settings.embeddedServiceConfig.htmlDirection&&"rtl"===embeddedservice_bootstrap.settings.embeddedServiceConfig.htmlDirection.toLowerCase()?"bottomleft":g;embeddedservice_bootstrap.settings.targetElement.appendChild(e);d.onload=function(){grecaptcha.ready(function(){ab=grecaptcha.render("embeddedMessagingRecaptchaBanner",{sitekey:c,size:"invisible",badge:g});a("ReCaptcha script loaded")})};d.onerror=function(n){n=(null==n?void 0:n.message)||n;r("loadReCaptchaScript",
n);b(n)};embeddedservice_bootstrap.settings.targetElement.appendChild(d)})}function Bb(){return new Promise((a,b)=>{try{grecaptcha.ready(function(){grecaptcha.execute(ab,{action:"AccessTokenRequest"}).then(function(c){a(c)}).catch(function(c){c=(null==c?void 0:c.message)||c;m("handleReCaptchaTokenGeneration",c);b(c)})})}catch(c){const d=(null==c?void 0:c.message)||c;r("handleReCaptchaTokenGeneration",d);b(d)}})}const Ea={},y={AUTH:"Auth",UNAUTH:"UnAuth",EXP_SITE_AUTH:"ExperienceSiteAuth"},dc={CONVERSATION:"Conversation",
SESSION:"Session"},Hb={INLINE:"inline",POPUP:"default"};class wb{static isValidContrastRatio(a,b,c=3){return this.getContrastRatio(a,b)>=c}static getContrastRatio(a,b){a=this.convertHexToRGB(a);b=this.convertHexToRGB(b);a=this.getRelativeLuminance(a);b=this.getRelativeLuminance(b);return((Math.max(a,b)+.05)/(Math.min(a,b)+.05)).toFixed(2)}static getRelativeLuminance(a){const [b,c,d]=Object.values(a).map(e=>this.getSRGB(e));return.2126*b+.7152*c+.0722*d}static getSRGB(a){a/=255;return.03928>=a?a/12.92:
Math.pow((a+.055)/1.055,2.4)}static convertHexToRGB(a){const b=parseInt(a.slice(1,3),16),c=parseInt(a.slice(3,5),16);a=parseInt(a.slice(5,7),16);return{r:b,g:c,b:a}}}const Bc=".salesforce.com .force.com .sfdc.net .site.com .salesforce-sites.com .crm.dev .crmforce.mil .salesforce.mil".split(" "),Ta={JWT:"JWT"},pb=document.title;let ab,ia,Sb=!1,L=!1,V=!1,da=!1,Ja=!1,Ia=!1,P={},ca={},M,F,x,A,Ha,Ga=new Promise(a=>{Ha=a}),ib;const sc=new Promise(a=>{ib=a});let jb,Cc=new Promise(a=>{jb=a}),Z,Q,ma,Ra,Xa;
const H={JWT:"JWT",FAILED_OUTBOUND_MESSAGE_ENTRIES:"FAILED_MESSAGES",CONVERSATION_BUTTON_CLICK_TIME:"CONVERSATION_BUTTON_CLICK_TIME"},oa={ENTER:"Enter",TAB:"Tab",SPACE:" "},Ya=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i,Qa={AURA:"AURA",
LWR:"LWR"};let pa,fa,ea,qa,Da={currentStateLogs:[],errorLogs:[]},kb,Tb=new Promise(a=>{kb=a});B.prototype.removeEventHandlers=function(){window.removeEventListener("message",fb);window.removeEventListener("storage",gb)};B.prototype.emitEmbeddedMessagingReadyEvent=function(){L=!0;try{z("onEmbeddedMessagingReady")}catch(a){L=!1,l("emitEmbeddedMessagingReadyEvent",`Something went wrong in firing onEmbeddedMessagingReady event ${a}.`)}};B.prototype.removeMarkup=function(a){const b=embeddedservice_bootstrap.utilAPI.getEmbeddedMessagingFrame(),
c=C(),d=document.getElementById("embeddedMessagingModalOverlay"),e=document.getElementById("embeddedMessagingMinimizedNotification"),g=S(),n=document.getElementById("inert-script");b?b.parentNode.removeChild(b):r("removeMarkup","Embedded Messaging iframe not available for resetting the client to initial state.");embeddedservice_bootstrap.filePreviewFrame&&embeddedservice_bootstrap.filePreviewFrame.parentNode?embeddedservice_bootstrap.filePreviewFrame.parentNode.removeChild(embeddedservice_bootstrap.filePreviewFrame):
r("removeMarkup","Embedded Messaging file preview iframe not available for resetting the client to initial state.");a&&embeddedservice_bootstrap.siteContextFrame&&embeddedservice_bootstrap.siteContextFrame.parentNode?embeddedservice_bootstrap.siteContextFrame.parentNode.removeChild(embeddedservice_bootstrap.siteContextFrame):r("removeMarkup","Embedded Messaging site context iframe not available for resetting the client to initial state.");d&&d.parentNode.removeChild(d);document.body.classList.contains("embeddedMessagingPreventScrolling")&&
(document.body.classList.remove("embeddedMessagingPreventScrolling"),embeddedservice_bootstrap.documentScrollPosition&&window.scrollTo(0,embeddedservice_bootstrap.documentScrollPosition));c?c.parentNode.removeChild(c):r("removeMarkup","Embedded Messaging static button not available for resetting the client to initial state.");e&&e.parentNode.removeChild(e);g&&g.parentNode.removeChild(g);n&&n.parentNode.removeChild(n);embeddedservice_bootstrap.emitEmbeddedMessagingReadyEvent();ua()};Za.prototype.setIdentityToken=
function(a){let b;if(!L)return l("setIdentityToken","Method can\u2019t be invoked before the onEmbeddedMessagingReady event is fired."),!1;if(u()!==y.AUTH)return l("setIdentityToken","User Verification isn\u2019t enabled in Messaging Settings."),!1;if(!a||null===a||"object"!==typeof a)return l("setIdentityToken","Invalid identity token parameter passed into the setIdentityToken method. Specify a valid object containing the token data."),!1;b=a.identityTokenType;a=a.identityToken;if("string"!==typeof b||
b.trim().toUpperCase()!==Ta.JWT)return l("setIdentityToken","Unsupported identity token. Only JWT-based identity tokens are supported."),!1;let c=!1;switch(b){case Ta.JWT:c=wa(a)}if(!c)return l("setIdentityToken","Invalid identity token passed into the setIdentityToken method."),!1;F=a;qa&&"function"===typeof qa&&(qa(),qa=void 0);m("setIdentityToken","Successfully set the customer identity token.");embeddedservice_bootstrap.utilAPI.getEmbeddedMessagingFrame()?t("EMBEDDED_MESSAGING_SET_IDENTITY_TOKEN_EVENT",
F):C()?C()&&document.getElementById("embeddedMessagingIconRefresh")&&(embeddedservice_bootstrap.removeMarkup(),embeddedservice_bootstrap.generateMarkup()):embeddedservice_bootstrap.generateMarkup();return!0};Za.prototype.clearSession=function(a){return new Promise((b,c)=>{pa=b;L?Ma(O(),!1,a):(c("Method can't be invoked before the onEmbeddedMessagingReady event is fired."),l("clearSession","Method cannot be invoked before the onEmbeddedMessagingReady event is fired."))})};ra.prototype.setHiddenPrechatFields=
function(a){if(Fa("setHiddenPrechatFields"))if(a&&"object"===typeof a)for(const [b,c]of Object.entries(a))Qb("setHiddenPrechatFields",b,c)&&(P[b]=c,m("setHiddenPrechatFields",`[setHiddenPrechatFields] Successfully updated Hidden Pre-Chat field ${b}.`));else l("setHiddenPrechatFields","When calling setHiddenPrechatFields, you must pass in an object with key-value pairs.")};ra.prototype.removeHiddenPrechatFields=function(a){Fa("removeHiddenPrechatFields")&&(a&&Array.isArray(a)?a.forEach(function(b){P.hasOwnProperty(b)?
(delete P[b],m("removeHiddenPrechatFields",`[removeHiddenPrechatFields] Successfully removed Hidden Pre-Chat field ${b}.`)):l("removeHiddenPrechatFields",`removeHiddenPrechatFields called with an invalid field name ${b}.`)}):l("removeHiddenPrechatFields","When calling removeHiddenPrechatFields, you must pass in an array of fields."))};ra.prototype.setVisiblePrechatFields=function(a){if(Fa("setVisiblePrechatFields")){var b=aa();if(a&&"object"===typeof a&&!Array.isArray(a)){a=Object.entries(a);for(const [c,
d]of a)if(Qb("setVisiblePrechatFields",c,d.value,d.isEditableByEndUser)){const e=b.find(g=>g.name===c);e.value=d.value;"boolean"===typeof d.isEditableByEndUser&&(e.isEditableByEndUser=d.isEditableByEndUser);m("setVisiblePrechatFields",`[setVisiblePrechatFields] Successfully updated Visible Pre-Chat field ${c}.`)}a.length&&Tb.then(()=>{t("EMBEDDED_MESSAGING_PUSH_VISIBLE_PRECHAT_FIELDS",aa())})}else l("setVisiblePrechatFields","setVisiblePrechatFields was called with an invalid object. Pass in an object with key-value pairs.")}};
ra.prototype.unsetVisiblePrechatFields=function(a){if(Fa("unsetVisiblePrechatFields")){var b=aa();a&&Array.isArray(a)&&a.length?(a.forEach(c=>{const d=b.find(e=>e.name===c);d?(delete d.value,delete d.isEditableByEndUser,m("unsetVisiblePrechatFields",`[unsetVisiblePrechatFields] Successfully unset Visible Pre-Chat field ${c}.`)):l("unsetVisiblePrechatFields",`unsetVisiblePrechatFields was called with an invalid field name: ${c}. Enter a valid field name to remove.`)}),Tb.then(()=>{t("EMBEDDED_MESSAGING_PUSH_VISIBLE_PRECHAT_FIELDS",
aa())})):l("unsetVisiblePrechatFields","When calling unsetVisiblePrechatFields, you must pass in an array of fields.")}};$a.prototype.setAutoResponseParameters=function(a){if(Rb("setAutoResponseParameters"))if(a&&"object"===typeof a)for(const [c,d]of Object.entries(a)){a=c;var b=d;"string"!==typeof a||1>a.trim().length?(l("validateAutoResponseParameter",`Expected a non-empty string for the parameter name, but received ${typeof a}`),a=!1):"string"!==typeof b||1>b.trim().length?(l("validateAutoResponseParameter",
`Expected a non-empty string for the parameter value, but received ${typeof b}`),a=!1):a=!0;a?(ca[c]=d,m("setAutoResponseParameters",`[setAutoResponseParameters] Successfully updated auto-response parameter ${c}`)):r("setAutoResponseParameters",`[setAutoResponseParameters] Failed to validate auto-response parameter ${c}`)}else l("setAutoResponseParameters","[setAutoResponseParameters] Must pass in an object of parameters as key-value pairs.")};$a.prototype.removeAutoResponseParameters=function(a){Rb("removeAutoResponseParameters")&&
(a&&Array.isArray(a)?a.forEach(function(b){ca.hasOwnProperty(b)?(delete ca[b],m("removeAutoResponseParameters",`[removeAutoResponseParameters] Successfully removed auto-response parameter ${b}`)):r("removeAutoResponseParameters",`[removeAutoResponseParameters] Failed to validate auto-response parameter ${b}`)}):l("removeAutoResponseParameters","[removeAutoResponseParameters] Must pass in an array of parameter names."))};R.prototype.getEmbeddedMessagingFrame=function(){return document.getElementById("embeddedMessagingFrame")};
R.prototype.prefetchResources=Jb;R.prototype.showChatButton=function(){var a=u();if(!L)return l("showChatButton","Method can't be invoked before the onEmbeddedMessagingReady event is fired."),!1;if(a===y.UNAUTH||F){if(a=C())return a.style.display="block",!0;na()&&ua(!0)}else l("showChatButton","Can't call showChatButton for a verified user before calling the setIdentity method with a valid token.");return!1};R.prototype.hideChatButton=function(){if(!L)return l("hideChatButton","Method can't be invoked before the onEmbeddedMessagingReady event is fired."),
!1;if(embeddedservice_bootstrap.utilAPI.getEmbeddedMessagingFrame())l("hideChatButton","Can\u2019t call hideChatButton once the messaging window is showing.");else{const a=C();if(a)return a.style.display="none",!0;na()&&ua(!1)}return!1};R.prototype.launchChat=function(){return new Promise((a,b)=>{let c;const d=()=>{let g;V||da?(g="[Launch Chat API] Successfully initialized the messaging client.",m("launchChat",g),a(g),window.removeEventListener("onEmbeddedMessagingInitSuccess",d),window.removeEventListener("onEmbeddedMessagingInitError",
e)):(g="[Launch Chat API] The messaging client initialized successfully or failed event isn\u2019t fired.",r("launchChat",g),b(g))},e=()=>{let g;V||da?(g="[Launch Chat API] Error launching the messaging client.",l("handleBootstrapError",g),b(g),window.removeEventListener("onEmbeddedMessagingInitSuccess",d),window.removeEventListener("onEmbeddedMessagingInitError",e),W()):(g="[Launch Chat API] The messaging client initialized successfully or failed event isn\u2019t fired.",r("launchChat",g),b(g))};
try{if(L){if(!C())if(na()&&(!O()||O()&&F))embeddedservice_bootstrap.generateMarkup(!0);else{c="[Launch Chat API] Default chat button isn\u2019t present. Check if the messaging client initialized successfully.";r("launchChat",c);b(c);return}if(embeddedservice_bootstrap.utilAPI.getEmbeddedMessagingFrame()){let g=embeddedservice_bootstrap.utilAPI.getEmbeddedMessagingFrame();g&&g.classList&&g.classList.contains("isMinimized")?(t("ESW_APP_MAXIMIZE"),m("launchChat","[Launch Chat API] Successfully maximized the messaging client."),
a("[Launch Chat API] Successfully maximized the messaging client.")):(c="[Launch Chat API] The messaging client window is already present and maximized.",r("launchChat",c),a(c))}else window.addEventListener("onEmbeddedMessagingInitSuccess",d),window.addEventListener("onEmbeddedMessagingInitError",e),ob().catch(g=>{c=`[Launch Chat API] Error when API simulates clicking the custom messaging client button: ${g}`;l("launchChat",c);b(c)})}else c="[Launch Chat API] Can\u2019t invoke API before the onEmbeddedMessagingReady event is fired.",
r("launchChat",c),b(c)}catch(g){c=`[Launch Chat API] Something went wrong launching the API: ${g}`,l("launchChat",c),b(c)}})};R.prototype.sendTextMessage=function(a){return new Promise((b,c)=>{try{Ja?(fa=b,ea=c,t("EMBEDDED_MESSAGING_PUBLIC_SEND_TEXT_MESSAGE_API_REQUEST",a)):(l("sendTextMessage","[Send Text Message API] Can\u2019t invoke API before the onEmbeddedMessagingConversationOpened event is fired."),c("[Send Text Message API] Can\u2019t invoke API before the onEmbeddedMessagingConversationOpened event is fired."))}catch(d){ea=
fa=void 0,b=`[Send Text Message API] Something went wrong sending text message: ${d}`,l("sendTextMessage",b),c(b)}})};R.prototype.removeAllComponents=function(){return new Promise(a=>{embeddedservice_bootstrap.removeMarkup(!0);embeddedservice_bootstrap.removeEventHandlers();document.querySelector("#embeddedMessagingBootstrapStyles")&&document.querySelector("#embeddedMessagingBootstrapStyles").remove();const b=`${I()}/assets/js/bootstrap`+(embeddedservice_bootstrap.settings.devMode?"":".min")+".js";
document.body.querySelector(`script[src="${b}"]`)&&document.body.querySelector(`script[src="${b}"]`).remove();m("removeAllComponents","Successfully removed all components.");delete window.embeddedservice_bootstrap;a()})};B.prototype.isValidEntityId=function(a){return"string"===typeof a&&(18===a.length||15===a.length)};B.prototype.getKeyPrefix=function(a){if(embeddedservice_bootstrap.isValidEntityId(a))return a.substr(0,3)};B.prototype.isOrganizationId=function(a){return"00D"===embeddedservice_bootstrap.getKeyPrefix(a)};
B.prototype.isMessageFromSalesforceDomain=function(a){var b=a.split(":")[1].replace("//","");if(Ba()&&b===document.domain)return!0;var c=function(d,e){return-1!==d.indexOf(e,d.length-e.length)};return Bc.some(function(d){return c(b,d)})};B.prototype.isMessageFromCustomDomain=function(a){a=a.split(":")[1].replace("//","");return"string"===typeof embeddedservice_bootstrap.settings.customDomain&&a===embeddedservice_bootstrap.settings.customDomain};B.prototype.generateMarkup=function(a=!1){var b=document.createDocumentFragment(),
c=S(),d=C();if(J()){var e=document.querySelector(".embeddedMessagingGRecaptchaBanner .grecaptcha-badge");e&&(e.classList.remove("isMaximized"),"hidden"===e.style.visibility&&(e.style.visibility="visible"))}if(na()&&!a)ua();else if(!c||!d){c=document.createElement("div");c.id="embedded-messaging";c.className="embedded-messaging"+(Ca()?`-${Hb.INLINE}`:"");a=document.createElement("div");d=document.createElement("button");wb.isValidContrastRatio("#FFFFFF",T("headerColor"))||document.documentElement.style.setProperty("--eswIconFillColor",
"#1A1B1E");e=document.createElement("div");const g=T("fabImage");let n;g&&0<g.length?(n=document.createElement("img"),n.src=g,n.setAttribute("alt",""),n.setAttribute("aria-hidden","true")):n=La(Ea.CHAT);n.setAttribute("id","embeddedMessagingIconChat");n.setAttribute("class","embeddedMessagingIconChat");e.id="embeddedMessagingIconContainer";e.className="embeddedMessagingIconContainer";e.appendChild(n);a.className="embeddedMessagingConversationButtonWrapper";d.classList.add("embeddedMessagingConversationButton");
d.id="embeddedMessagingConversationButton";d.href="javascript:void(0)";d.addEventListener("click",nb);d.addEventListener("keydown",vc);d.setAttribute("tabindex",0);d.setAttribute("role","button");d.setAttribute("aria-label",D("EmbeddedMessagingMinimizedState","DefaultMinimizedText")||"Hello, have a question? Let\u2019s chat.");d.setAttribute("title",D("EmbeddedMessagingMinimizedState","DefaultMinimizedText")||"Hello, have a question? Let\u2019s chat.");d.style.setProperty("--eswHeaderColor",T("headerColor"));
d.style.setProperty("--eswSecondaryColor",T("secondaryColor"));embeddedservice_bootstrap.settings.hasBottomTabBar&&d.classList.add("embeddedMessagingBottomTabBar");if((!va()||embeddedservice_bootstrap.settings.hideChatButtonOnLoad)&&!X()||Ca())d.style.display="none";embeddedservice_bootstrap.settings.embeddedServiceConfig.htmlDirection&&"string"===typeof embeddedservice_bootstrap.settings.embeddedServiceConfig.htmlDirection&&d.setAttribute("dir",embeddedservice_bootstrap.settings.embeddedServiceConfig.htmlDirection.toLowerCase());
Ba()&&d.classList.add("eswExperienceSite");d.appendChild(e);a.appendChild(d);d=a;b.appendChild(c);c.appendChild(d);embeddedservice_bootstrap.settings.targetElement.appendChild(b);try{z("onEmbeddedMessagingButtonCreated",{detail:{buttonVisibility:va()&&!embeddedservice_bootstrap.settings.hideChatButtonOnLoad||X()?"Show":"Hide"}})}catch(k){l("onEmbeddedMessagingButtonCreated",`Something went wrong in firing onEmbeddedMessagingButtonCreated event ${k}.`)}document.getElementById("inert-script")||(b=document.createElement("script"),
c=`${I()}/assets/js/inert${embeddedservice_bootstrap.settings.devMode?"":".min"}.js`,b.id="inert-script",b.type="text/javascript",b.src=c,embeddedservice_bootstrap.settings.targetElement.appendChild(b));b=document.createElement("div");b.id="embeddedMessagingLiveRegion";b.setAttribute("aria-live","assertive");b.setAttribute("aria-atomic","true");b.classList.add("embeddedMessagingLiveRegion");S().appendChild(b)}};B.prototype.createFilePreviewFrame=function(){const a=document.createElement("iframe"),
b=new URL(`${I()}/assets/htdocs/filepreview${embeddedservice_bootstrap.settings.devMode?"":".min"}.html`);b.searchParams.set("parent_domain",window.location.origin);a.classList.add("embeddedMessagingFilePreviewFrame");a.id="embeddedMessagingFilePreviewFrame";a.name="embeddedMessagingFilePreviewFrame";a.src=b.href;a.title=D("EmbeddedMessagingIframesAndContents","FilePreviewIframeTitle")||"Enlarged image preview";a.onload=()=>{m("createFilePreviewFrame","Created an iframe for file preview.")};embeddedservice_bootstrap.filePreviewFrame=
a;document.body.appendChild(a)};B.prototype.createIframe=function(){return new Promise((a,b)=>{try{const c=S(),d=document.createElement("iframe"),e=yc();d.title=D("EmbeddedMessagingIframesAndContents","MessagingIframeTitle")||"Chat with an Agent";d.className="embeddedMessagingFrame";d.id="embeddedMessagingFrame";d.onload=a;d.onerror=b;d.style.backgroundColor="transparent";"string"===typeof embeddedservice_bootstrap.settings.iframeAllow&&(d.allow=embeddedservice_bootstrap.settings.iframeAllow);d.allowTransparency=
"true";d.setAttribute("aria-label",D("EmbeddedMessagingChatHeader","ChatWindowAssistiveText")||"Chat Window");d.setAttribute("role","dialog");d.setAttribute("aria-modal","true");Ca()&&d.classList.add("embeddedMessagingFrameInline");embeddedservice_bootstrap.settings.omitSandbox||(d.sandbox="allow-scripts allow-same-origin allow-modals allow-downloads allow-popups allow-popups-to-escape-sandbox");embeddedservice_bootstrap.settings.isAuraSite?tc(d):uc(d);embeddedservice_bootstrap.settings.hasBottomTabBar&&
(d.classList.remove("embeddedMessagingFrameMinimizedBottomTabBar"),d.classList.add("embeddedMessagingFrameMaximizedBottomTabBar"));mb()?d.classList.add("eswMobilePublisher"):Ba()?d.classList.add("eswExperienceSite"):Va()&&d.classList.add("eswIsDesktop");embeddedservice_bootstrap.settings.embeddedServiceConfig.htmlDirection&&"string"===typeof embeddedservice_bootstrap.settings.embeddedServiceConfig.htmlDirection&&d.setAttribute("dir",embeddedservice_bootstrap.settings.embeddedServiceConfig.htmlDirection.toLowerCase());
d.onload=()=>{m("createIframe","Created Embedded Messaging frame.")};c.appendChild(e);c.appendChild(d)}catch(c){b(c)}})};B.prototype.bootstrapEmbeddedMessaging=function(){try{return embeddedservice_bootstrap.utilAPI.launchChat()}catch(a){throw Error("[Bootstrap API] Something went wrong bootstrapping Embedded Messaging: "+a);}};B.prototype.maximizeIframe=function(a,b){const c=C();var d=document.getElementById("embeddedMessagingModalOverlay");const e=document.getElementById("embeddedMessagingIconChat"),
g=document.getElementById("embeddedMessagingIconContainer"),n=document.querySelector('meta[name="viewport"]'),k=!!navigator.userAgent.match(/iP(hone|ad|od)/i),v=document.querySelector(".embeddedMessagingGRecaptchaBanner .grecaptcha-badge");a&&(a.classList.add("isMaximized"),a.classList.remove("isMinimized"),a.classList.remove("hasMinimizedNotification"),embeddedservice_bootstrap.settings.hasBottomTabBar&&(a.classList.remove("embeddedMessagingFrameMinimizedBottomTabBar"),a.classList.add("embeddedMessagingFrameMaximizedBottomTabBar")),
a=b&&b.height?`${b.height}px`:"480px",document.documentElement.style.setProperty("--eswWidth",b&&b.width?`${b.width}px`:"320px"),document.documentElement.style.setProperty("--eswHeight",a));c&&(c.style.display="none",c.setAttribute("tabindex",-1),c.setAttribute("aria-label",D("EmbeddedMessagingChatHeader","MinimizeButtonAssistiveText")||"Minimize the chat window"),c.setAttribute("title",D("EmbeddedMessagingChatHeader","MinimizeButtonAssistiveText")||"Minimize the chat window"),e.style.display="none",
document.getElementById("embeddedMessagingIconMinimize")||(b=La(Ea.MINIMIZE_MODAL),b.setAttribute("id","embeddedMessagingIconMinimize"),b.setAttribute("class","embeddedMessagingIconMinimize"),g.insertBefore(b,e)));d&&!d.classList.contains("isMaximized")&&d.classList.add("isMaximized");Va()||document.body.classList.contains("embeddedMessagingPreventScrolling")||(document.scrollingElement?embeddedservice_bootstrap.documentScrollPosition=document.scrollingElement.scrollTop:(d=document.documentElement.getBoundingClientRect(),
embeddedservice_bootstrap.documentScrollPosition=Math.abs(d.top)),document.body.classList.add("embeddedMessagingPreventScrolling"));k&&n?(Z=n.content,n.setAttribute("content","width=device-width, initial-scale=1, maximum-scale=1")):"Android"===Ua().os.name&&"Chrome"===Ua().browser.name&&n&&(Z=n.content,n.setAttribute("content","width=device-width, initial-scale=1, minimum-scale=1, interactive-widget=resizes-visual"));Ya.test(navigator.userAgent)&&Wa(!0);v&&v.classList.add("isMaximized");t("ESW_APP_MAXIMIZATION_RESIZING_COMPLETED");
m("maximizeIframe","Maximized the app");z("onEmbeddedMessagingWindowMaximized")};B.prototype.minimizeIframe=function(a,b){const c=C(),d=document.getElementById("embeddedMessagingModalOverlay"),e=document.getElementById("embeddedMessagingIconMinimize");b=b.hasMinimizedNotification;const g=document.querySelector(".embeddedMessagingGRecaptchaBanner .grecaptcha-badge");a&&(a.classList.remove("isMaximized"),a.classList.add("isMinimized"),b?a.classList.add("hasMinimizedNotification"):a.classList.remove("hasMinimizedNotification"),
embeddedservice_bootstrap.settings.hasBottomTabBar&&(a.classList.remove("embeddedMessagingFrameMaximizedBottomTabBar"),a.classList.add("embeddedMessagingFrameMinimizedBottomTabBar")));e&&e.remove();c&&(c.style.display="none",c.setAttribute("tabindex",-1),c.removeAttribute("title"),c.removeAttribute("aria-label"));d&&d.classList.contains("isMaximized")&&d.classList.remove("isMaximized");Va()||(document.body.classList.remove("embeddedMessagingPreventScrolling"),embeddedservice_bootstrap.documentScrollPosition&&
window.scrollTo(0,embeddedservice_bootstrap.documentScrollPosition));Z&&Ib();Ya.test(navigator.userAgent)&&Wa(!1);g&&g.classList.remove("isMaximized");t("ESW_APP_MINIMIZATION_RESIZING_COMPLETED");m("minimizeIframe","Minimized the app");z("onEmbeddedMessagingWindowMinimized")};B.prototype.initializeFeatureObjects=function(){embeddedservice_bootstrap.prechatAPI=new ra;embeddedservice_bootstrap.autoResponseAPI=new $a;embeddedservice_bootstrap.userVerificationAPI=new Za;embeddedservice_bootstrap.utilAPI=
new R};B.prototype.init=function(a,b,c,d){if(Sb)l("init","Attempted to initialize bootstrap multiple times",null,!0);else{Sb=!0;try{embeddedservice_bootstrap.settings.orgId=a;embeddedservice_bootstrap.settings.eswConfigDevName=b;embeddedservice_bootstrap.settings.siteURL=c;embeddedservice_bootstrap.settings.snippetConfig=d;A=db();m("init",`Initialized a new conversationId: ${A}`);eb(d||{});if("string"!==typeof embeddedservice_bootstrap.settings.siteURL||!embeddedservice_bootstrap.settings.siteURL.length)throw Error(`Expected a valid Site URL value to be a string but received: ${embeddedservice_bootstrap.settings.siteURL}.`);
if("string"!==typeof embeddedservice_bootstrap.settings.scrt2URL||!embeddedservice_bootstrap.settings.scrt2URL.length)throw Error(`Expected a valid SCRT 2.0 URL value to be a string but received: ${embeddedservice_bootstrap.settings.scrt2URL}.`);if(!embeddedservice_bootstrap.settings.orgId||!embeddedservice_bootstrap.isOrganizationId(embeddedservice_bootstrap.settings.orgId))throw Error("Invalid OrganizationId Parameter Value: "+embeddedservice_bootstrap.settings.orgId);if("string"!==typeof embeddedservice_bootstrap.settings.eswConfigDevName||
!embeddedservice_bootstrap.settings.eswConfigDevName.length)throw Error(`Expected a valid ESW Config Dev Name value to be a string but received: ${embeddedservice_bootstrap.settings.eswConfigDevName}.`);try{window.localStorage}catch(v){r("detectWebStorageAvailability","localStorage is not available. User chat sessions continue only in a single-page view and not across multiple pages."),embeddedservice_bootstrap.isLocalStorageAvailable=!1}try{window.sessionStorage}catch(v){r("detectWebStorageAvailability",
"sessionStorage is not available. User chat sessions end after a web page refresh or across browser tabs and windows."),embeddedservice_bootstrap.isSessionStorageAvailable=!1}Wb();if(!embeddedservice_bootstrap.settings.targetElement)throw Error("No targetElement specified.");Xb();pc();embeddedservice_bootstrap.settings.hasBottomTabBar=rc();embeddedservice_bootstrap.settings.isAuraSite=!!embeddedservice_bootstrap.settings.isAuraSite;embeddedservice_bootstrap.settings.omitSandbox=!!embeddedservice_bootstrap.settings.omitSandbox;
embeddedservice_bootstrap.settings.restrictSessionOnMessagingChannel=!!embeddedservice_bootstrap.settings.restrictSessionOnMessagingChannel;embeddedservice_bootstrap.settings.shouldMinimizeWindowOnNewTab=!!embeddedservice_bootstrap.settings.shouldMinimizeWindowOnNewTab;const e=qb().then(Promise.resolve.bind(Promise),()=>qb(I())).catch(()=>{N();throw Error("Error loading CSS.");}),g=rb().then(v=>{m("init","Successfully retrieved configuration settings");eb(v);v=embeddedservice_bootstrap.settings.embeddedServiceConfig;
embeddedservice_bootstrap.brandingData=v&&v.branding?v.branding:[];embeddedservice_bootstrap.settings.embeddedServiceConfig.scrt2URL=embeddedservice_bootstrap.settings.scrt2URL;embeddedservice_bootstrap.settings.embeddedServiceConfig.orgId=embeddedservice_bootstrap.settings.orgId;if(!embeddedservice_bootstrap.settings.embeddedServiceConfig)throw Error("Embedded Service Config settings not present in configuration response.");if(!embeddedservice_bootstrap.settings.embeddedServiceConfig.name)throw Error("Embedded Service Config developer name not present in configuration response.");
if(!embeddedservice_bootstrap.settings.embeddedServiceConfig.embeddedServiceMessagingChannel)throw Error("Embedded Service Messaging Channel settings not present in configuration response.");if(!embeddedservice_bootstrap.settings.embeddedServiceConfig.embeddedServiceMessagingChannel.authMode)throw Error("Auth mode setting not present in configuration response.");if(!Object.values(y).includes(embeddedservice_bootstrap.settings.embeddedServiceConfig.embeddedServiceMessagingChannel.authMode))throw Error("Auth mode in configuration response is invalid.");
if(Ba()){if(m("init",`Messaging for Web used in ${embeddedservice_bootstrap.settings.snippetConfig.expSiteContext} Experience Site context.`),embeddedservice_bootstrap.settings.expSiteAuthMode)if(O())embeddedservice_bootstrap.settings.embeddedServiceConfig.embeddedServiceMessagingChannel.authMode=y.EXP_SITE_AUTH;else throw l("init","User verification is not enabled in messaging channel."),Error("User verification is not enabled in messaging channel.");}else m("init","Messaging for Web used in External Site context.");
x=`${embeddedservice_bootstrap.settings.orgId}_WEB_STORAGE`;Ac()},v=>{l("init","Failed to retrieve configuration settings. Retrying the request");return new Promise((G,Aa)=>{rb().then(G,Aa)})}).catch(()=>{N();throw Error("Unable to load Embedded Messaging configuration.");});let n=g.then(()=>Lb()?Mb():Promise.resolve("ReCaptcha is not enabled or session exists"));g.then(()=>{ba("ESW_3RDPARTY_STORAGE_REQUEST",{orgId:embeddedservice_bootstrap.settings.orgId});embeddedservice_bootstrap.settings.disablePrefetch||
Jb()});const k=Oa().then(Promise.resolve.bind(Promise),v=>sb(v)).catch(v=>{l("init","Failed to retrieve Business Hours data.",v);N();throw Error("Failed to retrieve Business Hours data.");});Promise.all([e,g,k,Cc,n]).then(()=>{p();if(embeddedservice_bootstrap.isLocalStorageAvailable){var v=Object.keys(JSON.parse(localStorage.getItem(x)));m("logWebStorageItemsOnInit",`Local storage items on init: ${v}`)}embeddedservice_bootstrap.isSessionStorageAvailable&&(v=Object.keys(JSON.parse(sessionStorage.getItem(x))),
m("logWebStorageItemsOnInit",`Session storage items on init: ${v}`));embeddedservice_bootstrap.initializeFeatureObjects();embeddedservice_bootstrap.emitEmbeddedMessagingReadyEvent();if(X()){{M=q(H.JWT);v=embeddedservice_bootstrap.settings.embeddedServiceConfig.embeddedServiceMessagingChannel.channelAddressIdentifier||"";var G=Pb(M)||{};const Aa=G.channelAddId||"";G=G.coreRefId||"";embeddedservice_bootstrap.settings.restrictSessionOnMessagingChannel&&v!==Aa||u()===y.EXP_SITE_AUTH&&G!==embeddedservice_bootstrap.settings.snippetConfig.userId?
embeddedservice_bootstrap.userVerificationAPI.clearSession():(u()===y.EXP_SITE_AUTH&&xa(),embeddedservice_bootstrap.generateMarkup(!0),Kb(!0))}}else if(u()===y.UNAUTH||u()===y.EXP_SITE_AUTH&&!embeddedservice_bootstrap.settings.snippetConfig.isExpSiteGuestUser)u()===y.EXP_SITE_AUTH&&xa(),embeddedservice_bootstrap.generateMarkup();Ca()&&embeddedservice_bootstrap.utilAPI.launchChat()})}catch(e){N(),l("init",`Error: ${e}`)}}};window.embeddedservice_bootstrap?l("bootstrap load","attempting to load MIAW script when one is already loaded",
null,!0):window.embeddedservice_bootstrap=new B})();
